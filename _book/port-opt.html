<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Portfolio optimization | Portfolio Construction</title>
  <meta name="description" content="Portfolio construction with R" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Portfolio optimization | Portfolio Construction" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Portfolio construction with R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Portfolio optimization | Portfolio Construction" />
  
  <meta name="twitter:description" content="Portfolio construction with R" />
  

<meta name="author" content="Jian SHEN" />


<meta name="date" content="2020-11-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="machine-learning-basics.html"/>
<link rel="next" href="factor-investing.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Portfolio Construction</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i>Structure of the book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-information-and-conventions"><i class="fa fa-check"></i>Software information and conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#get-started"><i class="fa fa-check"></i><b>1.2</b> Get started</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#some-tips"><i class="fa fa-check"></i><b>1.3</b> Some tips</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="portfolio-basics.html"><a href="portfolio-basics.html"><i class="fa fa-check"></i><b>2</b> Portfolio basics</a><ul>
<li class="chapter" data-level="2.1" data-path="portfolio-basics.html"><a href="portfolio-basics.html#return"><i class="fa fa-check"></i><b>2.1</b> Return</a><ul>
<li class="chapter" data-level="2.1.1" data-path="portfolio-basics.html"><a href="portfolio-basics.html#stylized-facts"><i class="fa fa-check"></i><b>2.1.1</b> Stylized facts</a></li>
<li class="chapter" data-level="2.1.2" data-path="portfolio-basics.html"><a href="portfolio-basics.html#portfolio-return"><i class="fa fa-check"></i><b>2.1.2</b> Portfolio return</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="portfolio-basics.html"><a href="portfolio-basics.html#heuristic-portfolios"><i class="fa fa-check"></i><b>2.2</b> Heuristic portfolios</a><ul>
<li class="chapter" data-level="2.2.1" data-path="portfolio-basics.html"><a href="portfolio-basics.html#buy-hold-buy-rebalance"><i class="fa fa-check"></i><b>2.2.1</b> Buy &amp; Hold | Buy &amp; Rebalance</a></li>
<li class="chapter" data-level="2.2.2" data-path="portfolio-basics.html"><a href="portfolio-basics.html#equally-weighted-portfolio-ewp"><i class="fa fa-check"></i><b>2.2.2</b> Equally weighted portfolio (EWP)</a></li>
<li class="chapter" data-level="2.2.3" data-path="portfolio-basics.html"><a href="portfolio-basics.html#quintile-portfolio"><i class="fa fa-check"></i><b>2.2.3</b> Quintile portfolio</a></li>
<li class="chapter" data-level="2.2.4" data-path="portfolio-basics.html"><a href="portfolio-basics.html#global-maximum-return-portfolio-gmrp"><i class="fa fa-check"></i><b>2.2.4</b> Global maximum return portfolio (GMRP)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="portfolio-basics.html"><a href="portfolio-basics.html#comparison"><i class="fa fa-check"></i><b>2.3</b> Comparison</a></li>
<li class="chapter" data-level="2.4" data-path="portfolio-basics.html"><a href="portfolio-basics.html#model"><i class="fa fa-check"></i><b>2.4</b> Model</a><ul>
<li class="chapter" data-level="2.4.1" data-path="portfolio-basics.html"><a href="portfolio-basics.html#markowitz-1952-model-i.i.d.-model"><i class="fa fa-check"></i><b>2.4.1</b> Markowitz 1952 model (i.i.d. model)</a></li>
<li class="chapter" data-level="2.4.2" data-path="portfolio-basics.html"><a href="portfolio-basics.html#factor-model"><i class="fa fa-check"></i><b>2.4.2</b> Factor model</a></li>
<li class="chapter" data-level="2.4.3" data-path="portfolio-basics.html"><a href="portfolio-basics.html#time-series-models"><i class="fa fa-check"></i><b>2.4.3</b> Time-series models:</a></li>
<li class="chapter" data-level="2.4.4" data-path="portfolio-basics.html"><a href="portfolio-basics.html#fitting-method"><i class="fa fa-check"></i><b>2.4.4</b> Fitting method</a></li>
<li class="chapter" data-level="2.4.5" data-path="portfolio-basics.html"><a href="portfolio-basics.html#comment"><i class="fa fa-check"></i><b>2.4.5</b> Comment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="machine-learning-basics.html"><a href="machine-learning-basics.html"><i class="fa fa-check"></i><b>3</b> Machine learning basics</a></li>
<li class="chapter" data-level="4" data-path="port-opt.html"><a href="port-opt.html"><i class="fa fa-check"></i><b>4</b> Portfolio optimization</a><ul>
<li class="chapter" data-level="4.1" data-path="port-opt.html"><a href="port-opt.html#mean-variance-portfolio"><i class="fa fa-check"></i><b>4.1</b> Mean-variance portfolio</a><ul>
<li class="chapter" data-level="4.1.1" data-path="port-opt.html"><a href="port-opt.html#practical-constraints"><i class="fa fa-check"></i><b>4.1.1</b> Practical constraints</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="port-opt.html"><a href="port-opt.html#maximum-sharpe-ratio-portfolio-msrp"><i class="fa fa-check"></i><b>4.2</b> Maximum Sharpe ratio portfolio (MSRP)</a></li>
<li class="chapter" data-level="4.3" data-path="port-opt.html"><a href="port-opt.html#risk-based-portfolio"><i class="fa fa-check"></i><b>4.3</b> Risk based portfolio</a><ul>
<li class="chapter" data-level="4.3.1" data-path="port-opt.html"><a href="port-opt.html#global-minimum-variance-portfolio-gmvp"><i class="fa fa-check"></i><b>4.3.1</b> Global minimum variance portfolio (GMVP)</a></li>
<li class="chapter" data-level="4.3.2" data-path="port-opt.html"><a href="port-opt.html#inverse-volatility-portfolio-ivp"><i class="fa fa-check"></i><b>4.3.2</b> Inverse volatility portfolio (IVP)</a></li>
<li class="chapter" data-level="4.3.3" data-path="port-opt.html"><a href="port-opt.html#risk-parity-portfolio-rpp-or-equal-risk-portfolio-erp"><i class="fa fa-check"></i><b>4.3.3</b> Risk parity portfolio (RPP) or equal risk portfolio (ERP)</a></li>
<li class="chapter" data-level="4.3.4" data-path="port-opt.html"><a href="port-opt.html#most-diversified-portfolio-mdp"><i class="fa fa-check"></i><b>4.3.4</b> Most diversified portfolio (MDP)</a></li>
<li class="chapter" data-level="4.3.5" data-path="port-opt.html"><a href="port-opt.html#maximum-decorrelation-portfolio-mdcp"><i class="fa fa-check"></i><b>4.3.5</b> Maximum decorrelation portfolio (MDCP)</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="port-opt.html"><a href="port-opt.html#comparison_chap4"><i class="fa fa-check"></i><b>4.4</b> Comparison</a></li>
<li class="chapter" data-level="4.5" data-path="port-opt.html"><a href="port-opt.html#rebalancing-frequencies"><i class="fa fa-check"></i><b>4.5</b> Rebalancing frequencies</a></li>
<li class="chapter" data-level="4.6" data-path="port-opt.html"><a href="port-opt.html#rolling-window-portfolios"><i class="fa fa-check"></i><b>4.6</b> Rolling window portfolios</a></li>
<li class="chapter" data-level="4.7" data-path="port-opt.html"><a href="port-opt.html#todo"><i class="fa fa-check"></i><b>4.7</b> TODO</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="factor-investing.html"><a href="factor-investing.html"><i class="fa fa-check"></i><b>5</b> Factor investing</a><ul>
<li class="chapter" data-level="5.1" data-path="factor-investing.html"><a href="factor-investing.html#factor-overview"><i class="fa fa-check"></i><b>5.1</b> Factor overview</a></li>
<li class="chapter" data-level="5.2" data-path="factor-investing.html"><a href="factor-investing.html#macroeconomic-factor"><i class="fa fa-check"></i><b>5.2</b> Macroeconomic factor</a><ul>
<li class="chapter" data-level="5.2.1" data-path="factor-investing.html"><a href="factor-investing.html#ls-fitting-simple-form"><i class="fa fa-check"></i><b>5.2.1</b> LS fitting – simple form</a></li>
<li class="chapter" data-level="5.2.2" data-path="factor-investing.html"><a href="factor-investing.html#ls-fitting-matrix-form"><i class="fa fa-check"></i><b>5.2.2</b> LS fitting – matrix form</a></li>
<li class="chapter" data-level="5.2.3" data-path="factor-investing.html"><a href="factor-investing.html#estimating-covriacne"><i class="fa fa-check"></i><b>5.2.3</b> Estimating covriacne</a></li>
<li class="chapter" data-level="5.2.4" data-path="factor-investing.html"><a href="factor-investing.html#evaluating-etfs-performance"><i class="fa fa-check"></i><b>5.2.4</b> Evaluating ETFs performance</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="factor-investing.html"><a href="factor-investing.html#fama-french"><i class="fa fa-check"></i><b>5.3</b> Fama-French</a></li>
<li class="chapter" data-level="5.4" data-path="factor-investing.html"><a href="factor-investing.html#statisticalprincipal-factor-models"><i class="fa fa-check"></i><b>5.4</b> Statistical/principal factor models</a></li>
<li class="chapter" data-level="5.5" data-path="factor-investing.html"><a href="factor-investing.html#comparison-of-covariance-matrix-estimations"><i class="fa fa-check"></i><b>5.5</b> Comparison of covariance matrix estimations</a></li>
<li class="chapter" data-level="5.6" data-path="factor-investing.html"><a href="factor-investing.html#edhec-smart-beta"><i class="fa fa-check"></i><b>5.6</b> Edhec smart beta</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html"><i class="fa fa-check"></i><b>6</b> Robust portfolio design</a><ul>
<li class="chapter" data-level="6.1" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#motivationChapt6"><i class="fa fa-check"></i><b>6.1</b> Motivation</a></li>
<li class="chapter" data-level="6.2" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#sensitivity-of-different-portfolio-design"><i class="fa fa-check"></i><b>6.2</b> Sensitivity of different portfolio design</a><ul>
<li class="chapter" data-level="6.2.1" data-path="portfolio-basics.html"><a href="portfolio-basics.html#global-maximum-return-portfolio-gmrp"><i class="fa fa-check"></i><b>6.2.1</b> Global Maximum Return Portfolio (GMRP)</a></li>
<li class="chapter" data-level="6.2.2" data-path="port-opt.html"><a href="port-opt.html#global-minimum-variance-portfolio-gmvp"><i class="fa fa-check"></i><b>6.2.2</b> Global Minimum Variance Portfolio (GMVP)</a></li>
<li class="chapter" data-level="6.2.3" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#markowitzs-mean-variance-portfolio"><i class="fa fa-check"></i><b>6.2.3</b> Markowitz’s mean-variance portfolio</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#robust-portfolio-optimization"><i class="fa fa-check"></i><b>6.3</b> Robust portfolio optimization</a><ul>
<li class="chapter" data-level="6.3.1" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#worst-case-robust-gmrp"><i class="fa fa-check"></i><b>6.3.1</b> Worst-case robust GMRP</a></li>
<li class="chapter" data-level="6.3.2" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#worst-case-robust-gmvp"><i class="fa fa-check"></i><b>6.3.2</b> Worst-case robust GMVP</a></li>
<li class="chapter" data-level="6.3.3" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#worst-case-markowitzs-portfolio"><i class="fa fa-check"></i><b>6.3.3</b> Worst-case Markowitz’s portfolio</a></li>
<li class="chapter" data-level="6.3.4" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#variance-uncertainty-based-on-factor-model"><i class="fa fa-check"></i><b>6.3.4</b> Variance uncertainty based on factor model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html"><i class="fa fa-check"></i><b>7</b> Alternative risk measure</a><ul>
<li class="chapter" data-level="7.1" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#motivation_alter_risk_measure"><i class="fa fa-check"></i><b>7.1</b> Motivation</a></li>
<li class="chapter" data-level="7.2" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#risk-measure"><i class="fa fa-check"></i><b>7.2</b> Risk measure</a></li>
<li class="chapter" data-level="7.3" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#alternative-risk-measure-beased-portfolio"><i class="fa fa-check"></i><b>7.3</b> Alternative risk measure beased portfolio</a><ul>
<li class="chapter" data-level="7.3.1" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean-downside-risk-portfolio"><i class="fa fa-check"></i><b>7.3.1</b> Mean-downside risk portfolio</a></li>
<li class="chapter" data-level="7.3.2" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean-cvar-portfolio"><i class="fa fa-check"></i><b>7.3.2</b> Mean-CVaR portfolio</a></li>
<li class="chapter" data-level="7.3.3" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean-dd-portfolio"><i class="fa fa-check"></i><b>7.3.3</b> Mean-DD portfolio</a></li>
<li class="chapter" data-level="7.3.4" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean---ave-dd-portfolio"><i class="fa fa-check"></i><b>7.3.4</b> Mean - Ave-DD portfolio</a></li>
<li class="chapter" data-level="7.3.5" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean-cdar-portfolio"><i class="fa fa-check"></i><b>7.3.5</b> Mean-CDaR portfolio</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#comparison-of-dr-cvar-and-dd-portfolios"><i class="fa fa-check"></i><b>7.4</b> Comparison of DR, CVaR, and DD portfolios</a></li>
<li class="chapter" data-level="7.5" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#conclusion"><i class="fa fa-check"></i><b>7.5</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html"><i class="fa fa-check"></i><b>8</b> Risk parity portfolio</a><ul>
<li class="chapter" data-level="8.1" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#motiv_risk_parity"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#formulation"><i class="fa fa-check"></i><b>8.2</b> Formulation</a></li>
<li class="chapter" data-level="8.3" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#risk-budgeting-portfolio-rbp"><i class="fa fa-check"></i><b>8.3</b> Risk budgeting portfolio (RBP)</a><ul>
<li class="chapter" data-level="8.3.1" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#naive-risk-budgeting-portfolio"><i class="fa fa-check"></i><b>8.3.1</b> Naive risk budgeting portfolio</a></li>
<li class="chapter" data-level="8.3.2" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#inverse-volatility-portfolio"><i class="fa fa-check"></i><b>8.3.2</b> Inverse volatility portfolio</a></li>
<li class="chapter" data-level="8.3.3" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#pnl-comparison"><i class="fa fa-check"></i><b>8.3.3</b> PnL comparison</a></li>
<li class="chapter" data-level="8.3.4" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#vanilla-rpp"><i class="fa fa-check"></i><b>8.3.4</b> vanilla RPP</a></li>
<li class="chapter" data-level="8.3.5" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#rpp-general-formulation"><i class="fa fa-check"></i><b>8.3.5</b> RPP: General formulation</a></li>
<li class="chapter" data-level="8.3.6" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#rbp-formulations"><i class="fa fa-check"></i><b>8.3.6</b> RBP formulations</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Portfolio Construction</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="port_opt" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Portfolio optimization</h1>
<p>ADD Overview of this chapter</p>
<div id="mean-variance-portfolio" class="section level2">
<h2><span class="header-section-number">4.1</span> Mean-variance portfolio</h2>
<p>We start the section by recalling the math optimization problem of Mean-variance portfolio (MVP).</p>
<p><span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{maximize}} &amp; \mathbf{w}^{T}\boldsymbol{\mu}-\lambda\mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}\\
\textsf{subject to} &amp; \mathbf{1}^T\mathbf{w}=1
\end{array}\]</span></p>
<p>This is a convex quadratic problem (QP) with only one linear constraint which admits a closed-form solution:</p>
<p><span class="math display">\[\mathbf{w}_{\sf MVP} = \frac{1}{2\lambda}\boldsymbol{\Sigma}^{-1}\left(\boldsymbol{\mu}+\nu\mathbf{1}\right)\]</span>
where <span class="math inline">\(\nu\)</span> is the optimal dual variable <span class="math inline">\(\nu=\frac{2\lambda-\mathbf{1}^{T}\boldsymbol{\Sigma}^{-1}\boldsymbol{\mu}}{\mathbf{1}^{T}\boldsymbol{\Sigma}^{-1}\mathbf{1}}\)</span>.</p>
<p>There are two alternative obvious reformulations for Markowitz’s portfolio.</p>
<p><strong>Maximization of mean return:</strong></p>
<p><span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{maximize}} &amp; \mathbf{w}^{T}\boldsymbol{\mu}\\
\textsf{subject to} 
&amp; \mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}\leq\alpha\\
&amp; \mathbf{1}^{T}\mathbf{w}=1.
\end{array}\]</span></p>
<p><strong>Minimization of risk:</strong></p>
<p><span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{minimize}} &amp; \mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}\\
\textsf{subject to} 
&amp; \mathbf{w}^{T}\boldsymbol{\mu}\geq\beta\\
&amp; \mathbf{1}^{T}\mathbf{w}=1.
\end{array}\]</span></p>
<p>By sweeping over <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, or<span class="math inline">\(\lambda\)</span>, one can recover the whole Pareto optimal curve.</p>
<p>The previous three problems result in the same mean-variance trade-off curve (Pareto curve):</p>
<p><code>TODO add frontier curve here</code></p>
<div id="practical-constraints" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Practical constraints</h3>
<p><span class="math display">\[\begin{array}{lll}
\underset{\mathbf{w}}{\textsf{maximize}} &amp; 
\mathbf{w}^{T}\boldsymbol{\mu}-\lambda\mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w} &amp; \\
\textsf{subject to}
&amp; \mathbf{w}^{T}\mathbf{1}=1 &amp; \text{budget}\\
&amp; \mathbf{w}\ge\mathbf{0} &amp; \text{no shorting}\\
&amp; \left\Vert \mathbf{w}\right\Vert _{1}\leq\gamma &amp; \text{leverage}\\
&amp; \left\Vert \mathbf{w}-\mathbf{w}_{0}\right\Vert _{1}\leq\tau &amp; \text{turnover}\\
&amp; \left\Vert \mathbf{w}\right\Vert _{\infty}\leq u &amp; \text{max position}\\
&amp; \left\Vert \mathbf{w}\right\Vert _{0}\leq K &amp; \text{sparsity}
\end{array}\]</span></p>
<p>K controls the cardinality of the portfolio (to select a small set of stocks from the universe) .Without the sparsity constraint, the problem can be rewritten as a QP.</p>
<p>Interestingly, the MVP formulation can be interpreted as a regression. (could also view it as a replicating problem trying to <code>#TODO see uppal's lecture</code>)</p>
<p>The key observation is that the variance of the portfolio can be seen as an L2-norm error term</p>
<p><span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w},\rho}{\textsf{minimize}} &amp; \|\mathbf{R}\mathbf{w} - \rho\mathbf{1}\|^2 - \frac{1}{\lambda}\rho\\
\textsf{subject to} 
&amp; \rho = \mathbf{w}^T\boldsymbol{\mu}\\
&amp; \mathbf{1}^T\mathbf{w}=1\\
\end{array}\]</span></p>
<p>Intuitively, this reformulation is trying to achieve the expected return ρ with minimum variance in the L2-norm sense.</p>
</div>
</div>
<div id="maximum-sharpe-ratio-portfolio-msrp" class="section level2">
<h2><span class="header-section-number">4.2</span> Maximum Sharpe ratio portfolio (MSRP)</h2>
<p><span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{maximize}} &amp;
\dfrac{\mathbf{w}^{T}\boldsymbol{\mu}-r_{f}}{\sqrt{\mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}}}\\
\textsf{subject to} &amp; \mathbf{1}^{T}\mathbf{w}=1, \quad\left(\mathbf{w}\geq\mathbf{0}\right)
\end{array}\]</span></p>
<p>However, this problem is not convex! This problem belong to the class of fractional programming (FP) with many methods available for its resolution. Or rewrite in convex form as</p>
<p><span class="math display">\[\begin{array}{ll}
\underset{\tilde{\mathbf{w}}}{\textsf{minimize}} &amp; \tilde{\mathbf{w}}^T\mathbf{\Sigma}\tilde{\mathbf{w}}\\
{\textsf{subject to}}
 &amp; \tilde{\mathbf{w}}^T\boldsymbol{\mu} = 1\\
 &amp; \tilde{\mathbf{w}}\ge\mathbf{0}
\end{array}\]</span></p>
</div>
<div id="risk-based-portfolio" class="section level2">
<h2><span class="header-section-number">4.3</span> Risk based portfolio</h2>
<p>Risk-based portfolios try to bypass the high sensitivity of Markowitz’s mean-variance portfolio to the estimation errors of the expected returns by not making use of the expected returns altogether. They are based only on the covariance matrix <span class="citation">(Ardia, Boudt, and Gagnon Fleury <a href="#ref-ardia2017riskportfolios" role="doc-biblioref">2017</a>)</span>.</p>
<div id="global-minimum-variance-portfolio-gmvp" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Global minimum variance portfolio (GMVP)</h3>
<p><span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{minimize}} &amp; \mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}\\
\textsf{subject to} 
&amp; \mathbf{1}^T\mathbf{w}=1, \;\mathbf{w}\geq\mathbf{0}.
\end{array}\]</span></p>
<p><span class="math display">\[\mathbf{w}_{\sf GMVP}=\frac{1}{\mathbf{1}^{T}\boldsymbol{\Sigma}^{-1}\mathbf{1}}\boldsymbol{\Sigma}^{-1}\mathbf{1}\]</span></p>
</div>
<div id="inverse-volatility-portfolio-ivp" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Inverse volatility portfolio (IVP)</h3>
<p><span class="math display">\[\mathbf{w} = \frac{\boldsymbol{\sigma}^{-1}}{\mathbf{1}^T\boldsymbol{\sigma}^{-1}}\]</span>
where <span class="math inline">\(\boldsymbol{\sigma}^2 = {\sf Diag(\boldsymbol{\Sigma})}\)</span></p>
<p>IVP is also called “equal volatility” portfolio since the weighted constituent assets have equal volatility. Also, IVP ignores the asset correlations.</p>
<p><span class="math display">\[{\sf sd}(w_ir_i) = w_i\sigma_i = 1/N\]</span></p>
</div>
<div id="risk-parity-portfolio-rpp-or-equal-risk-portfolio-erp" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Risk parity portfolio (RPP) or equal risk portfolio (ERP)</h3>
<p>The risk parity portfolio (RPP) or equal risk portfolio (ERP) aims at equalizing the risk contribution from the invested assets in the global portfolio risk.</p>
</div>
<div id="most-diversified-portfolio-mdp" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Most diversified portfolio (MDP)</h3>
<p>If markets are risk-efficient, then investments will produce returns in proportion to their total risk (measured by volatility)</p>
<p>The diversification ratio (DR) was defined analogous to the Sharpe ratio (SR):
<span class="math display">\[\mathsf{DR}   = \frac{\mathbf{w}^{T}\boldsymbol{\sigma}}{\sqrt{\mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}}}\]</span></p>
<p><span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{maximize}} &amp;
\dfrac{\mathbf{w}^{T}\boldsymbol{\sigma}}{\sqrt{\mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}}}\\
\textsf{subject to} &amp; \mathbf{1}^{T}\mathbf{w}=1.
\end{array}\]</span></p>
</div>
<div id="maximum-decorrelation-portfolio-mdcp" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Maximum decorrelation portfolio (MDCP)</h3>
<p>The maximum decorrelation portfolio (MDCP) is closely related to GMVP and MDP, but applies to the case where an investor believes all assets have similar returns and volatility, but heterogeneous correlations.</p>
<p><span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{minimize}} &amp; \mathbf{w}^{T}\mathbf{C}\mathbf{w}\\
\textsf{subject to} &amp; \mathbf{1}^{T}\mathbf{w}=1
\end{array}\]</span>
where <span class="math inline">\(\mathbf{C} \triangleq \mathsf{Diag}(\boldsymbol{\Sigma})^{-1/2}\boldsymbol{\Sigma}\mathsf{Diag}(\boldsymbol{\Sigma})^{-1/2}\)</span></p>
<p>The MDCP happen to</p>
<ul>
<li>maximize the DR when all assets have equal volatility and</li>
<li>maximize the SR when all assets have equal risks and returns.</li>
</ul>
</div>
</div>
<div id="comparison_chap4" class="section level2">
<h2><span class="header-section-number">4.4</span> Comparison</h2>
<p><code>TODO Write functions/backtesting to</code>
<code>deal with multiple datasets</code>
<code>used a training data window to design the portfolio</code>
<code>evaluation on a rolling-window basis</code></p>
<p>Comparison of MVP, GMVP, IVP, MSRP, MDP, MDCP, as well as the previous heuristic portfolios (EWP, quintile portfolio, and GMRP) with the constraint: <strong>long-only</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="port-opt.html#cb1-1"></a>from &lt;-<span class="st"> &quot;2016-01-01&quot;</span></span>
<span id="cb1-2"><a href="port-opt.html#cb1-2"></a>to &lt;-<span class="st"> &quot;2020-10-30&quot;</span></span>
<span id="cb1-3"><a href="port-opt.html#cb1-3"></a>tickers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AAPL&quot;</span>, <span class="st">&quot;AMD&quot;</span>, <span class="st">&quot;ADI&quot;</span>,  <span class="st">&quot;ABBV&quot;</span>, <span class="st">&quot;AEZS&quot;</span>, <span class="st">&quot;A&quot;</span>,  <span class="st">&quot;APD&quot;</span>, <span class="st">&quot;AA&quot;</span>,<span class="st">&quot;CF&quot;</span>)</span>
<span id="cb1-4"><a href="port-opt.html#cb1-4"></a><span class="kw">assign_variable_global_env</span>(tickers, from, to, <span class="dt">ratio=</span><span class="fl">0.7</span>)</span>
<span id="cb1-5"><a href="port-opt.html#cb1-5"></a></span>
<span id="cb1-6"><a href="port-opt.html#cb1-6"></a>T_trn &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="fl">0.7</span><span class="op">*</span><span class="kw">nrow</span>(X_lin))</span>
<span id="cb1-7"><a href="port-opt.html#cb1-7"></a>mu &lt;-<span class="st"> </span><span class="kw">colMeans</span>(X_log_trn)</span>
<span id="cb1-8"><a href="port-opt.html#cb1-8"></a>Sigma &lt;-<span class="st"> </span><span class="kw">cov</span>(X_log_trn)</span>
<span id="cb1-9"><a href="port-opt.html#cb1-9"></a></span>
<span id="cb1-10"><a href="port-opt.html#cb1-10"></a>w_EWP    &lt;-<span class="st"> </span><span class="kw">EWP</span>(X_log_trn)</span>
<span id="cb1-11"><a href="port-opt.html#cb1-11"></a>w_QuintP &lt;-<span class="st"> </span><span class="kw">quintileP</span>(X_log_trn)</span>
<span id="cb1-12"><a href="port-opt.html#cb1-12"></a>w_GMRP   &lt;-<span class="st"> </span><span class="kw">GMRP</span>(mu)</span>
<span id="cb1-13"><a href="port-opt.html#cb1-13"></a></span>
<span id="cb1-14"><a href="port-opt.html#cb1-14"></a>w_MVP    &lt;-<span class="st"> </span><span class="kw">MVP</span>(mu, Sigma, <span class="dt">lmd=</span><span class="dv">2</span>, <span class="dt">long_only =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-15"><a href="port-opt.html#cb1-15"></a>w_MSRP   &lt;-<span class="st"> </span><span class="kw">MSRP</span>(mu, Sigma)</span>
<span id="cb1-16"><a href="port-opt.html#cb1-16"></a>w_GMVP   &lt;-<span class="st"> </span><span class="kw">GMVP</span>(Sigma, <span class="dt">long_only =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-17"><a href="port-opt.html#cb1-17"></a>w_IVP    &lt;-<span class="st"> </span><span class="kw">IVP</span>(Sigma)</span>
<span id="cb1-18"><a href="port-opt.html#cb1-18"></a>w_MDP    &lt;-<span class="st"> </span><span class="kw">MDP</span>(Sigma)</span>
<span id="cb1-19"><a href="port-opt.html#cb1-19"></a>w_MDCP   &lt;-<span class="st"> </span><span class="kw">MDCP</span>(Sigma)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="port-opt.html#cb2-1"></a></span>
<span id="cb2-2"><a href="port-opt.html#cb2-2"></a>w_heuristic &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="st">&quot;EWP&quot;</span>    =<span class="st"> </span>w_EWP, </span>
<span id="cb2-3"><a href="port-opt.html#cb2-3"></a>                     <span class="st">&quot;QuintP&quot;</span> =<span class="st"> </span>w_QuintP[, <span class="st">&quot;QuintP (mu/sigma)&quot;</span>], </span>
<span id="cb2-4"><a href="port-opt.html#cb2-4"></a>                     <span class="st">&quot;GMRP&quot;</span>   =<span class="st"> </span>w_GMRP)</span>
<span id="cb2-5"><a href="port-opt.html#cb2-5"></a>w_Markowitz &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="st">&quot;MVP&quot;</span>    =<span class="st"> </span>w_MVP, </span>
<span id="cb2-6"><a href="port-opt.html#cb2-6"></a>                     <span class="st">&quot;GMVP&quot;</span>   =<span class="st"> </span>w_GMVP, </span>
<span id="cb2-7"><a href="port-opt.html#cb2-7"></a>                     <span class="st">&quot;IVP&quot;</span>    =<span class="st"> </span>w_IVP, </span>
<span id="cb2-8"><a href="port-opt.html#cb2-8"></a>                     <span class="st">&quot;MSRP&quot;</span>   =<span class="st"> </span>w_MSRP, </span>
<span id="cb2-9"><a href="port-opt.html#cb2-9"></a>                     <span class="st">&quot;MDP&quot;</span>    =<span class="st"> </span>w_MDP, </span>
<span id="cb2-10"><a href="port-opt.html#cb2-10"></a>                     <span class="st">&quot;MDCP&quot;</span>   =<span class="st"> </span>w_MDCP)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="port-opt.html#cb3-1"></a>w_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(w_heuristic, w_Markowitz)</span>
<span id="cb3-2"><a href="port-opt.html#cb3-2"></a><span class="kw">barplot</span>(w_all, <span class="dt">col =</span> rainbow10equal[<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>], <span class="dt">legend =</span> <span class="kw">rownames</span>(w_all), <span class="dt">beside =</span> <span class="ot">TRUE</span>,</span>
<span id="cb3-3"><a href="port-opt.html#cb3-3"></a>        <span class="dt">main =</span> <span class="st">&quot;Portfolio allocation&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;portfolios&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;weights&quot;</span>)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="port-opt.html#cb4-1"></a><span class="co"># compute returns of all portfolios</span></span>
<span id="cb4-2"><a href="port-opt.html#cb4-2"></a>ret_all &lt;-<span class="st"> </span><span class="kw">xts</span>(X_lin <span class="op">%*%</span><span class="st"> </span>w_all, <span class="kw">index</span>(X_lin))</span>
<span id="cb4-3"><a href="port-opt.html#cb4-3"></a>ret_all_trn &lt;-<span class="st"> </span>ret_all[<span class="dv">1</span><span class="op">:</span>T_trn, ]</span>
<span id="cb4-4"><a href="port-opt.html#cb4-4"></a>ret_all_tst &lt;-<span class="st"> </span>ret_all[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>T_trn), ]</span>
<span id="cb4-5"><a href="port-opt.html#cb4-5"></a></span>
<span id="cb4-6"><a href="port-opt.html#cb4-6"></a><span class="co"># performance</span></span>
<span id="cb4-7"><a href="port-opt.html#cb4-7"></a><span class="kw">t</span>(<span class="kw">table.AnnualizedReturns</span>(ret_all_trn)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span><span class="st">`</span><span class="dt">Annualized Sharpe (Rf=0%)</span><span class="st">`</span>)</span>
<span id="cb4-8"><a href="port-opt.html#cb4-8"></a><span class="co">#&gt;        Annualized Return Annualized Std Dev Annualized Sharpe (Rf=0%)</span></span>
<span id="cb4-9"><a href="port-opt.html#cb4-9"></a><span class="co">#&gt; MVP               0.4598             0.2602                    1.7669</span></span>
<span id="cb4-10"><a href="port-opt.html#cb4-10"></a><span class="co">#&gt; MSRP              0.3503             0.1996                    1.7552</span></span>
<span id="cb4-11"><a href="port-opt.html#cb4-11"></a><span class="co">#&gt; QuintP            0.6297             0.3758                    1.6754</span></span>
<span id="cb4-12"><a href="port-opt.html#cb4-12"></a><span class="co">#&gt; GMRP              0.9717             0.6913                    1.4055</span></span>
<span id="cb4-13"><a href="port-opt.html#cb4-13"></a><span class="co">#&gt; GMVP              0.2152             0.1577                    1.3642</span></span>
<span id="cb4-14"><a href="port-opt.html#cb4-14"></a><span class="co">#&gt; IVP               0.2458             0.1862                    1.3199</span></span>
<span id="cb4-15"><a href="port-opt.html#cb4-15"></a><span class="co">#&gt; EWP               0.3019             0.2430                    1.2426</span></span>
<span id="cb4-16"><a href="port-opt.html#cb4-16"></a><span class="co">#&gt; MDP               0.2683             0.2202                    1.2183</span></span>
<span id="cb4-17"><a href="port-opt.html#cb4-17"></a><span class="co">#&gt; MDCP              0.3235             0.3523                    0.9182</span></span>
<span id="cb4-18"><a href="port-opt.html#cb4-18"></a><span class="kw">t</span>(<span class="kw">table.AnnualizedReturns</span>(ret_all_tst)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span><span class="st">`</span><span class="dt">Annualized Sharpe (Rf=0%)</span><span class="st">`</span>)</span>
<span id="cb4-19"><a href="port-opt.html#cb4-19"></a><span class="co">#&gt;        Annualized Return Annualized Std Dev Annualized Sharpe (Rf=0%)</span></span>
<span id="cb4-20"><a href="port-opt.html#cb4-20"></a><span class="co">#&gt; GMRP              1.0621             0.5763                    1.8428</span></span>
<span id="cb4-21"><a href="port-opt.html#cb4-21"></a><span class="co">#&gt; QuintP            0.6561             0.4111                    1.5959</span></span>
<span id="cb4-22"><a href="port-opt.html#cb4-22"></a><span class="co">#&gt; MVP               0.5087             0.3714                    1.3697</span></span>
<span id="cb4-23"><a href="port-opt.html#cb4-23"></a><span class="co">#&gt; MSRP              0.4316             0.3468                    1.2444</span></span>
<span id="cb4-24"><a href="port-opt.html#cb4-24"></a><span class="co">#&gt; GMVP              0.2992             0.3197                    0.9357</span></span>
<span id="cb4-25"><a href="port-opt.html#cb4-25"></a><span class="co">#&gt; IVP               0.2029             0.3319                    0.6114</span></span>
<span id="cb4-26"><a href="port-opt.html#cb4-26"></a><span class="co">#&gt; MDP               0.0976             0.3437                    0.2838</span></span>
<span id="cb4-27"><a href="port-opt.html#cb4-27"></a><span class="co">#&gt; EWP               0.0782             0.3658                    0.2138</span></span>
<span id="cb4-28"><a href="port-opt.html#cb4-28"></a><span class="co">#&gt; MDCP             -0.1131             0.4374                   -0.2585</span></span></code></pre></div>
<p>We can observe that:</p>
<p>as expected, the MSRP achieves the maximum ex ante (in-sample) Sharpe ratio; however, this is not maintained ex post (out-of-sample);
as expected, the EWP achieves the best ex post performance;
the MVP performs poorly;
other top performers include the IVP and MDP.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="port-opt.html#cb5-1"></a>{ <span class="kw">chart.CumReturns</span>(ret_all, <span class="dt">main =</span> <span class="st">&quot;Cumulative return of portfolios&quot;</span>,</span>
<span id="cb5-2"><a href="port-opt.html#cb5-2"></a>                   <span class="dt">wealth.index =</span> <span class="ot">TRUE</span>, <span class="dt">legend.loc =</span> <span class="st">&quot;topleft&quot;</span>, <span class="dt">colorset =</span> rich10equal)</span>
<span id="cb5-3"><a href="port-opt.html#cb5-3"></a>  <span class="kw">addEventLines</span>(<span class="kw">xts</span>(<span class="st">&quot;training&quot;</span>, <span class="kw">index</span>(X_lin[T_trn])), <span class="dt">srt=</span><span class="dv">90</span>, <span class="dt">pos=</span><span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkblue&quot;</span>) }</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-7-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="port-opt.html#cb6-1"></a><span class="kw">chart.CumReturns</span>(ret_all_tst, <span class="dt">main =</span> <span class="st">&quot;Cumulative return of portfolios (out-of-sample)&quot;</span>,</span>
<span id="cb6-2"><a href="port-opt.html#cb6-2"></a>                   <span class="dt">wealth.index =</span> <span class="ot">TRUE</span>, <span class="dt">legend.loc =</span> <span class="st">&quot;topleft&quot;</span>, <span class="dt">colorset =</span> rich10equal)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="port-opt.html#cb7-1"></a><span class="kw">chart.Drawdown</span>(ret_all_tst, <span class="dt">main =</span> <span class="st">&quot;Drawdown of portfolios (out-of-sample)&quot;</span>, </span>
<span id="cb7-2"><a href="port-opt.html#cb7-2"></a>               <span class="dt">legend.loc =</span> <span class="st">&quot;bottomleft&quot;</span>, <span class="dt">colorset =</span> rich10equal)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="port-opt.html#cb8-1"></a><span class="co"># first, compute the efficient frontier</span></span>
<span id="cb8-2"><a href="port-opt.html#cb8-2"></a>w_frontier_trn &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb8-3"><a href="port-opt.html#cb8-3"></a>lmd_sweep &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="dt">by =</span> <span class="fl">0.5</span>))</span>
<span id="cb8-4"><a href="port-opt.html#cb8-4"></a><span class="cf">for</span> (lmd <span class="cf">in</span> lmd_sweep)</span>
<span id="cb8-5"><a href="port-opt.html#cb8-5"></a>  w_frontier_trn &lt;-<span class="st"> </span><span class="kw">cbind</span>(w_frontier_trn, <span class="kw">MVP</span>(mu, Sigma, lmd, <span class="dt">long_only =</span> <span class="ot">TRUE</span>))</span>
<span id="cb8-6"><a href="port-opt.html#cb8-6"></a></span>
<span id="cb8-7"><a href="port-opt.html#cb8-7"></a>ret_frontier_trn &lt;-<span class="st"> </span><span class="kw">xts</span>(X_lin_trn <span class="op">%*%</span><span class="st"> </span>w_frontier_trn, <span class="kw">index</span>(X_lin_trn))</span>
<span id="cb8-8"><a href="port-opt.html#cb8-8"></a>mu_frontier_trn &lt;-<span class="st"> </span><span class="kw">table.AnnualizedReturns</span>(ret_frontier_trn)[<span class="dv">1</span>, ]</span>
<span id="cb8-9"><a href="port-opt.html#cb8-9"></a>sd_frontier_trn &lt;-<span class="st"> </span><span class="kw">table.AnnualizedReturns</span>(ret_frontier_trn)[<span class="dv">2</span>, ]</span>
<span id="cb8-10"><a href="port-opt.html#cb8-10"></a></span>
<span id="cb8-11"><a href="port-opt.html#cb8-11"></a><span class="co"># plot in-sample sd-mu scatter plot</span></span>
<span id="cb8-12"><a href="port-opt.html#cb8-12"></a>maxSR &lt;-<span class="st"> </span><span class="kw">table.AnnualizedReturns</span>(ret_all_trn[, <span class="st">&quot;MSRP&quot;</span>])[<span class="dv">3</span>, ]</span>
<span id="cb8-13"><a href="port-opt.html#cb8-13"></a></span>
<span id="cb8-14"><a href="port-opt.html#cb8-14"></a>{<span class="kw">chart.RiskReturnScatter</span>(ret_all_trn,</span>
<span id="cb8-15"><a href="port-opt.html#cb8-15"></a>                        <span class="dt">main =</span> <span class="st">&quot;Annualized Return and Risk (in-sample)&quot;</span>,</span>
<span id="cb8-16"><a href="port-opt.html#cb8-16"></a>                        <span class="dt">symbolset =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">21</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="dv">22</span>, <span class="dv">6</span>)),</span>
<span id="cb8-17"><a href="port-opt.html#cb8-17"></a>                        <span class="dt">colorset =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;darkred&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;darkblue&quot;</span>, <span class="dv">6</span>)),</span>
<span id="cb8-18"><a href="port-opt.html#cb8-18"></a>                        <span class="dt">bg =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb8-19"><a href="port-opt.html#cb8-19"></a>                        <span class="dt">add.sharpe =</span> maxSR)</span>
<span id="cb8-20"><a href="port-opt.html#cb8-20"></a><span class="kw">lines</span>(sd_frontier_trn, mu_frontier_trn)}</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="port-opt.html#cb9-1"></a><span class="co"># compute the efficient frontier again but based on the test data</span></span>
<span id="cb9-2"><a href="port-opt.html#cb9-2"></a>mu_tst &lt;-<span class="st"> </span><span class="kw">colMeans</span>(X_log_tst)</span>
<span id="cb9-3"><a href="port-opt.html#cb9-3"></a>Sigma_tst &lt;-<span class="st"> </span><span class="kw">cov</span>(X_log_tst)</span>
<span id="cb9-4"><a href="port-opt.html#cb9-4"></a></span>
<span id="cb9-5"><a href="port-opt.html#cb9-5"></a>w_frontier_tst &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb9-6"><a href="port-opt.html#cb9-6"></a>lmd_sweep &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="dt">by =</span> <span class="fl">0.5</span>))</span>
<span id="cb9-7"><a href="port-opt.html#cb9-7"></a><span class="cf">for</span> (lmd <span class="cf">in</span> lmd_sweep)</span>
<span id="cb9-8"><a href="port-opt.html#cb9-8"></a>  w_frontier_tst &lt;-<span class="st"> </span><span class="kw">cbind</span>(w_frontier_tst, <span class="kw">MVP</span>(mu_tst, Sigma_tst, lmd))</span>
<span id="cb9-9"><a href="port-opt.html#cb9-9"></a>ret_frontier_tst &lt;-<span class="st"> </span><span class="kw">xts</span>(X_lin_tst <span class="op">%*%</span><span class="st"> </span>w_frontier_tst, <span class="kw">index</span>(X_lin_tst))</span>
<span id="cb9-10"><a href="port-opt.html#cb9-10"></a>mu_frontier_tst &lt;-<span class="st"> </span><span class="kw">table.AnnualizedReturns</span>(ret_frontier_tst)[<span class="dv">1</span>, ]</span>
<span id="cb9-11"><a href="port-opt.html#cb9-11"></a>sd_frontier_tst &lt;-<span class="st"> </span><span class="kw">table.AnnualizedReturns</span>(ret_frontier_tst)[<span class="dv">2</span>, ]</span>
<span id="cb9-12"><a href="port-opt.html#cb9-12"></a></span>
<span id="cb9-13"><a href="port-opt.html#cb9-13"></a><span class="co"># plot out-of-sample sd-mu scatter plot</span></span>
<span id="cb9-14"><a href="port-opt.html#cb9-14"></a><span class="kw">chart.RiskReturnScatter</span>(ret_all_tst,</span>
<span id="cb9-15"><a href="port-opt.html#cb9-15"></a>                        <span class="dt">main =</span> <span class="st">&quot;Annualized Return and Risk (out-of-sample)&quot;</span>,</span>
<span id="cb9-16"><a href="port-opt.html#cb9-16"></a>                        <span class="dt">symbolset =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">21</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="dv">22</span>, <span class="dv">6</span>)),</span>
<span id="cb9-17"><a href="port-opt.html#cb9-17"></a>                        <span class="dt">colorset =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;darkred&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;darkblue&quot;</span>, <span class="dv">6</span>)),</span>
<span id="cb9-18"><a href="port-opt.html#cb9-18"></a>                        <span class="dt">bg =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb9-19"><a href="port-opt.html#cb9-19"></a>                        <span class="dt">add.sharpe =</span> <span class="ot">NA</span>,</span>
<span id="cb9-20"><a href="port-opt.html#cb9-20"></a>                        <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb9-21"><a href="port-opt.html#cb9-21"></a><span class="co">#&gt; Warning in rug(side = 2, returns, col = element.color): some values will be</span></span>
<span id="cb9-22"><a href="port-opt.html#cb9-22"></a><span class="co">#&gt; clipped</span></span>
<span id="cb9-23"><a href="port-opt.html#cb9-23"></a><span class="kw">lines</span>(sd_frontier_tst, mu_frontier_tst)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-11-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="rebalancing-frequencies" class="section level2">
<h2><span class="header-section-number">4.5</span> Rebalancing frequencies</h2>
<p>In the previous performance analysis of the different portfolios, we were implicitly assuming a daily rebalancing. Observe that on the day of the rebalancing, the portfolio held will be the designed one w_EWP but in the subsequent days without rebalancing such portfolio slowly deviates as the prices of the stocks change.</p>
<p><code>TODO change function Return.portfolio to your own functions given any rebalanced days (frequency)</code></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="port-opt.html#cb10-1"></a><span class="co"># choose portfolio for the comparison</span></span>
<span id="cb10-2"><a href="port-opt.html#cb10-2"></a>w &lt;-<span class="st"> </span>w_EWP</span>
<span id="cb10-3"><a href="port-opt.html#cb10-3"></a><span class="co"># recall the computation for the daily rebalancing (with daily returns)</span></span>
<span id="cb10-4"><a href="port-opt.html#cb10-4"></a>ret_daily_rebal &lt;-<span class="st"> </span>X_lin <span class="op">%*%</span><span class="st"> </span>w</span>
<span id="cb10-5"><a href="port-opt.html#cb10-5"></a><span class="co"># we can alternativaly use this function:</span></span>
<span id="cb10-6"><a href="port-opt.html#cb10-6"></a><span class="co"># let&#39;s observe how the portfolio slowly deviates from its original design</span></span>
<span id="cb10-7"><a href="port-opt.html#cb10-7"></a>tmp &lt;-<span class="st"> </span><span class="kw">Return.portfolio</span>(X_lin, <span class="dt">weights =</span> w, <span class="dt">rebalance_on =</span> <span class="st">&quot;years&quot;</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb10-8"><a href="port-opt.html#cb10-8"></a><span class="kw">chart.StackedBar</span>(tmp<span class="op">$</span>BOP.Weight, <span class="dt">main =</span> <span class="st">&quot;Evolution of uniform portfolio with yearly rebalancing&quot;</span>,</span>
<span id="cb10-9"><a href="port-opt.html#cb10-9"></a>                 <span class="dt">ylab =</span> <span class="st">&quot;w&quot;</span>, <span class="dt">space =</span> <span class="dv">0</span>, <span class="dt">border =</span> <span class="ot">NA</span>)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-12-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="port-opt.html#cb11-1"></a></span>
<span id="cb11-2"><a href="port-opt.html#cb11-2"></a>frequency &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;days&quot;</span>, <span class="st">&quot;weeks&quot;</span>, <span class="st">&quot;months&quot;</span>, <span class="st">&quot;quarters&quot;</span>, <span class="st">&quot;years&quot;</span>)</span>
<span id="cb11-3"><a href="port-opt.html#cb11-3"></a>ret_allfreqs &lt;-<span class="st"> </span><span class="kw">do.call</span>(merge,<span class="kw">lapply</span>(frequency, <span class="dt">FUN =</span> <span class="cf">function</span>(freq){</span>
<span id="cb11-4"><a href="port-opt.html#cb11-4"></a>  <span class="kw">Return.portfolio</span>(<span class="dt">R =</span> X_lin, <span class="dt">weights =</span> w, <span class="dt">rebalance_on =</span> freq)}))</span>
<span id="cb11-5"><a href="port-opt.html#cb11-5"></a><span class="kw">colnames</span>(ret_allfreqs) &lt;-<span class="st"> </span>frequency</span>
<span id="cb11-6"><a href="port-opt.html#cb11-6"></a></span>
<span id="cb11-7"><a href="port-opt.html#cb11-7"></a><span class="kw">t</span>(<span class="kw">table.AnnualizedReturns</span>(ret_allfreqs))</span>
<span id="cb11-8"><a href="port-opt.html#cb11-8"></a><span class="co">#&gt;          Annualized Return Annualized Std Dev Annualized Sharpe (Rf=0%)</span></span>
<span id="cb11-9"><a href="port-opt.html#cb11-9"></a><span class="co">#&gt; days                0.2302             0.2854                    0.8068</span></span>
<span id="cb11-10"><a href="port-opt.html#cb11-10"></a><span class="co">#&gt; weeks               0.2355             0.2841                    0.8289</span></span>
<span id="cb11-11"><a href="port-opt.html#cb11-11"></a><span class="co">#&gt; months              0.2150             0.2830                    0.7597</span></span>
<span id="cb11-12"><a href="port-opt.html#cb11-12"></a><span class="co">#&gt; quarters            0.2278             0.2855                    0.7979</span></span>
<span id="cb11-13"><a href="port-opt.html#cb11-13"></a><span class="co">#&gt; years               0.2293             0.2744                    0.8356</span></span>
<span id="cb11-14"><a href="port-opt.html#cb11-14"></a><span class="kw">chart.CumReturns</span>(ret_allfreqs, <span class="dt">main =</span> <span class="st">&quot;Daily wealth for different rebalancing frequencies&quot;</span>,</span>
<span id="cb11-15"><a href="port-opt.html#cb11-15"></a>                 <span class="dt">wealth.index =</span> <span class="ot">TRUE</span>, <span class="dt">legend.loc =</span> <span class="st">&quot;topleft&quot;</span>, <span class="dt">colorset =</span> rich6equal)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-12-2.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="rolling-window-portfolios" class="section level2">
<h2><span class="header-section-number">4.6</span> Rolling window portfolios</h2>
<p>Until now, we have considered static portfolios in the sense that they are first designed based on a training set and then they remain fixed and are used in the test set. In a more realistic setting, however, one wants to implement this procedure in a rolling-window basis. That is, with some frequency the portfolio is reoptimized (since the dynamics of the asset returns may change with time) and rebalanced.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="port-opt.html#cb12-1"></a>T &lt;-<span class="st"> </span><span class="kw">nrow</span>(X_lin)</span>
<span id="cb12-2"><a href="port-opt.html#cb12-2"></a>T_trn &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="fl">0.5</span><span class="op">*</span>T)</span>
<span id="cb12-3"><a href="port-opt.html#cb12-3"></a>X_log_trn &lt;-<span class="st"> </span>X_log[<span class="dv">1</span><span class="op">:</span>T_trn, ]</span>
<span id="cb12-4"><a href="port-opt.html#cb12-4"></a>X_log_tst &lt;-<span class="st"> </span>X_log[(T_trn<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>T, ]</span>
<span id="cb12-5"><a href="port-opt.html#cb12-5"></a>X_lin_trn &lt;-<span class="st"> </span>X_lin[<span class="dv">1</span><span class="op">:</span>T_trn, ]</span>
<span id="cb12-6"><a href="port-opt.html#cb12-6"></a>X_lin_tst &lt;-<span class="st"> </span>X_lin[(T_trn<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>T, ]</span>
<span id="cb12-7"><a href="port-opt.html#cb12-7"></a>mu &lt;-<span class="st"> </span><span class="kw">colMeans</span>(X_log_trn)</span>
<span id="cb12-8"><a href="port-opt.html#cb12-8"></a>Sigma &lt;-<span class="st"> </span><span class="kw">cov</span>(X_log_trn)</span>
<span id="cb12-9"><a href="port-opt.html#cb12-9"></a></span>
<span id="cb12-10"><a href="port-opt.html#cb12-10"></a><span class="co"># create empty portfolio matrix</span></span>
<span id="cb12-11"><a href="port-opt.html#cb12-11"></a>w_MVP_rolling &lt;-<span class="st"> </span>X_log</span>
<span id="cb12-12"><a href="port-opt.html#cb12-12"></a>w_MVP_rolling[] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb12-13"><a href="port-opt.html#cb12-13"></a>rebal_indices &lt;-<span class="st"> </span>T_trn <span class="op">+</span><span class="st"> </span><span class="kw">endpoints</span>(X_log_tst, <span class="dt">on =</span> <span class="st">&quot;months&quot;</span>)</span>
<span id="cb12-14"><a href="port-opt.html#cb12-14"></a></span>
<span id="cb12-15"><a href="port-opt.html#cb12-15"></a><span class="co"># run the rolling window loop</span></span>
<span id="cb12-16"><a href="port-opt.html#cb12-16"></a>lookback &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">*</span><span class="dv">20</span>  <span class="co"># maximum value is: floor(T_trn/20)*20</span></span>
<span id="cb12-17"><a href="port-opt.html#cb12-17"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(rebal_indices)) {</span>
<span id="cb12-18"><a href="port-opt.html#cb12-18"></a>  <span class="co"># estimate moments</span></span>
<span id="cb12-19"><a href="port-opt.html#cb12-19"></a>  X_ &lt;-<span class="st"> </span>X_log[(rebal_indices[i] <span class="op">-</span><span class="st"> </span>lookback <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span>rebal_indices[i], ]</span>
<span id="cb12-20"><a href="port-opt.html#cb12-20"></a>  mu &lt;-<span class="st"> </span><span class="kw">colMeans</span>(X_)</span>
<span id="cb12-21"><a href="port-opt.html#cb12-21"></a>  Sigma &lt;-<span class="st"> </span><span class="kw">cov</span>(X_)</span>
<span id="cb12-22"><a href="port-opt.html#cb12-22"></a>  <span class="co"># design portfolio</span></span>
<span id="cb12-23"><a href="port-opt.html#cb12-23"></a>  w_MVP_rolling[rebal_indices[i], ] &lt;-<span class="st"> </span><span class="kw">MVP</span>(mu, Sigma, <span class="dt">lmd =</span> <span class="dv">2</span>, <span class="dt">long_only =</span> <span class="ot">TRUE</span>)</span>
<span id="cb12-24"><a href="port-opt.html#cb12-24"></a>}</span>
<span id="cb12-25"><a href="port-opt.html#cb12-25"></a>w_MVP_rolling &lt;-<span class="st"> </span><span class="kw">na.omit</span>(w_MVP_rolling)</span>
<span id="cb12-26"><a href="port-opt.html#cb12-26"></a></span>
<span id="cb12-27"><a href="port-opt.html#cb12-27"></a><span class="co"># compute portfolio returns</span></span>
<span id="cb12-28"><a href="port-opt.html#cb12-28"></a>tmp &lt;-<span class="st"> </span><span class="kw">Return.portfolio</span>(X_lin_tst, <span class="dt">weights =</span> w_MVP_rolling, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb12-29"><a href="port-opt.html#cb12-29"></a>ret_rolling &lt;-<span class="st"> </span>tmp<span class="op">$</span>returns</span>
<span id="cb12-30"><a href="port-opt.html#cb12-30"></a><span class="kw">chart.StackedBar</span>(tmp<span class="op">$</span>BOP.Weight, <span class="dt">main =</span> <span class="st">&quot;Evolution of rolling-window Markowitz&#39;s mean-variance portfolio&quot;</span>,</span>
<span id="cb12-31"><a href="port-opt.html#cb12-31"></a>                 <span class="dt">ylab =</span> <span class="st">&quot;w&quot;</span>, <span class="dt">space =</span> <span class="dv">0</span>, <span class="dt">border =</span> <span class="ot">NA</span>)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-13-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>We can now compare the static and rolling window versions:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="port-opt.html#cb13-1"></a><span class="co"># performance</span></span>
<span id="cb13-2"><a href="port-opt.html#cb13-2"></a>w_MVP_static &lt;-<span class="st"> </span><span class="kw">MVP</span>(mu, Sigma, <span class="dt">lmd =</span> <span class="dv">2</span>, <span class="dt">long_only =</span> <span class="ot">TRUE</span>)</span>
<span id="cb13-3"><a href="port-opt.html#cb13-3"></a>ret_static &lt;-<span class="st"> </span><span class="kw">Return.portfolio</span>(X_lin_tst, <span class="dt">weights =</span> w_MVP_static, <span class="dt">rebalance_on =</span> <span class="st">&quot;months&quot;</span>)</span>
<span id="cb13-4"><a href="port-opt.html#cb13-4"></a></span>
<span id="cb13-5"><a href="port-opt.html#cb13-5"></a>ret_MVP &lt;-<span class="st"> </span><span class="kw">cbind</span>(ret_static, ret_rolling)</span>
<span id="cb13-6"><a href="port-opt.html#cb13-6"></a><span class="kw">colnames</span>(ret_MVP) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Markowitz MVP - static&quot;</span>, <span class="st">&quot;Markowitz MVP - rolling window&quot;</span>)</span>
<span id="cb13-7"><a href="port-opt.html#cb13-7"></a></span>
<span id="cb13-8"><a href="port-opt.html#cb13-8"></a><span class="kw">t</span>(<span class="kw">table.AnnualizedReturns</span>(ret_MVP))</span>
<span id="cb13-9"><a href="port-opt.html#cb13-9"></a><span class="co">#&gt;                                Annualized Return Annualized Std Dev</span></span>
<span id="cb13-10"><a href="port-opt.html#cb13-10"></a><span class="co">#&gt; Markowitz MVP - static                    0.5449             0.3492</span></span>
<span id="cb13-11"><a href="port-opt.html#cb13-11"></a><span class="co">#&gt; Markowitz MVP - rolling window            0.1603             0.4264</span></span>
<span id="cb13-12"><a href="port-opt.html#cb13-12"></a><span class="co">#&gt;                                Annualized Sharpe (Rf=0%)</span></span>
<span id="cb13-13"><a href="port-opt.html#cb13-13"></a><span class="co">#&gt; Markowitz MVP - static                            1.5604</span></span>
<span id="cb13-14"><a href="port-opt.html#cb13-14"></a><span class="co">#&gt; Markowitz MVP - rolling window                    0.3759</span></span>
<span id="cb13-15"><a href="port-opt.html#cb13-15"></a><span class="kw">chart.CumReturns</span>(ret_MVP, <span class="dt">main =</span> <span class="st">&quot;Daily wealth for static vs rolling window&quot;</span>,</span>
<span id="cb13-16"><a href="port-opt.html#cb13-16"></a>                 <span class="dt">wealth.index =</span> <span class="ot">TRUE</span>, <span class="dt">legend.loc =</span> <span class="st">&quot;topleft&quot;</span>, <span class="dt">colorset =</span> rich6equal)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-14-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="port-opt.html#cb14-1"></a><span class="kw">chart.Drawdown</span>(ret_MVP, <span class="dt">main =</span> <span class="st">&quot;Drawdown for static vs rolling window&quot;</span>, </span>
<span id="cb14-2"><a href="port-opt.html#cb14-2"></a>               <span class="dt">legend.loc =</span> <span class="st">&quot;bottomleft&quot;</span>, <span class="dt">colorset =</span> rich6equal)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-14-2.png" width="80%" style="display: block; margin: auto;" />
Very strange and contradictional that static set outperform the rolling window portfolio</p>
</div>
<div id="todo" class="section level2">
<h2><span class="header-section-number">4.7</span> TODO</h2>
<p><code>TODO Use your own portfolioBacktest package</code></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-ardia2017riskportfolios">
<p>Ardia, David, Kris Boudt, and Jean-Philippe Gagnon Fleury. 2017. “RiskPortfolios: Computation of Risk-Based Portfolios in R.” <em>Journal of Open Source Software</em> 10 (2).</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="machine-learning-basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="factor-investing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["portr.pdf", "portr.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
