<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Risk parity portfolio | Portfolio Construction</title>
  <meta name="description" content="Portfolio construction with R" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Risk parity portfolio | Portfolio Construction" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Portfolio construction with R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Risk parity portfolio | Portfolio Construction" />
  
  <meta name="twitter:description" content="Portfolio construction with R" />
  

<meta name="author" content="Jian SHEN" />


<meta name="date" content="2020-11-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="alternative-risk-measure.html"/>
<link rel="next" href="appendix-a.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Portfolio Construction</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i>Structure of the book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-information-and-conventions"><i class="fa fa-check"></i>Software information and conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#get-started"><i class="fa fa-check"></i><b>1.2</b> Get started</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#some-tips"><i class="fa fa-check"></i><b>1.3</b> Some tips</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="portfolio-basics.html"><a href="portfolio-basics.html"><i class="fa fa-check"></i><b>2</b> Portfolio basics</a><ul>
<li class="chapter" data-level="2.1" data-path="portfolio-basics.html"><a href="portfolio-basics.html#return"><i class="fa fa-check"></i><b>2.1</b> Return</a><ul>
<li class="chapter" data-level="2.1.1" data-path="portfolio-basics.html"><a href="portfolio-basics.html#stylized-facts"><i class="fa fa-check"></i><b>2.1.1</b> Stylized facts</a></li>
<li class="chapter" data-level="2.1.2" data-path="portfolio-basics.html"><a href="portfolio-basics.html#portfolio-return"><i class="fa fa-check"></i><b>2.1.2</b> Portfolio return</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="portfolio-basics.html"><a href="portfolio-basics.html#heuristic-portfolios"><i class="fa fa-check"></i><b>2.2</b> Heuristic portfolios</a><ul>
<li class="chapter" data-level="2.2.1" data-path="portfolio-basics.html"><a href="portfolio-basics.html#buy-hold-buy-rebalance"><i class="fa fa-check"></i><b>2.2.1</b> Buy &amp; Hold | Buy &amp; Rebalance</a></li>
<li class="chapter" data-level="2.2.2" data-path="portfolio-basics.html"><a href="portfolio-basics.html#equally-weighted-portfolio-ewp"><i class="fa fa-check"></i><b>2.2.2</b> Equally weighted portfolio (EWP)</a></li>
<li class="chapter" data-level="2.2.3" data-path="portfolio-basics.html"><a href="portfolio-basics.html#quintile-portfolio"><i class="fa fa-check"></i><b>2.2.3</b> Quintile portfolio</a></li>
<li class="chapter" data-level="2.2.4" data-path="portfolio-basics.html"><a href="portfolio-basics.html#global-maximum-return-portfolio-gmrp"><i class="fa fa-check"></i><b>2.2.4</b> Global maximum return portfolio (GMRP)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="portfolio-basics.html"><a href="portfolio-basics.html#comparison"><i class="fa fa-check"></i><b>2.3</b> Comparison</a></li>
<li class="chapter" data-level="2.4" data-path="portfolio-basics.html"><a href="portfolio-basics.html#model"><i class="fa fa-check"></i><b>2.4</b> Model</a><ul>
<li class="chapter" data-level="2.4.1" data-path="portfolio-basics.html"><a href="portfolio-basics.html#markowitz-1952-model-i.i.d.-model"><i class="fa fa-check"></i><b>2.4.1</b> Markowitz 1952 model (i.i.d. model)</a></li>
<li class="chapter" data-level="2.4.2" data-path="portfolio-basics.html"><a href="portfolio-basics.html#factor-model"><i class="fa fa-check"></i><b>2.4.2</b> Factor model</a></li>
<li class="chapter" data-level="2.4.3" data-path="portfolio-basics.html"><a href="portfolio-basics.html#time-series-models"><i class="fa fa-check"></i><b>2.4.3</b> Time-series models:</a></li>
<li class="chapter" data-level="2.4.4" data-path="portfolio-basics.html"><a href="portfolio-basics.html#fitting-method"><i class="fa fa-check"></i><b>2.4.4</b> Fitting method</a></li>
<li class="chapter" data-level="2.4.5" data-path="portfolio-basics.html"><a href="portfolio-basics.html#comment"><i class="fa fa-check"></i><b>2.4.5</b> Comment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="machine-learning-basics.html"><a href="machine-learning-basics.html"><i class="fa fa-check"></i><b>3</b> Machine learning basics</a></li>
<li class="chapter" data-level="4" data-path="port-opt.html"><a href="port-opt.html"><i class="fa fa-check"></i><b>4</b> Portfolio optimization</a><ul>
<li class="chapter" data-level="4.1" data-path="port-opt.html"><a href="port-opt.html#mean-variance-portfolio"><i class="fa fa-check"></i><b>4.1</b> Mean-variance portfolio</a><ul>
<li class="chapter" data-level="4.1.1" data-path="port-opt.html"><a href="port-opt.html#practical-constraints"><i class="fa fa-check"></i><b>4.1.1</b> Practical constraints</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="port-opt.html"><a href="port-opt.html#maximum-sharpe-ratio-portfolio-msrp"><i class="fa fa-check"></i><b>4.2</b> Maximum Sharpe ratio portfolio (MSRP)</a></li>
<li class="chapter" data-level="4.3" data-path="port-opt.html"><a href="port-opt.html#risk-based-portfolio"><i class="fa fa-check"></i><b>4.3</b> Risk based portfolio</a><ul>
<li class="chapter" data-level="4.3.1" data-path="port-opt.html"><a href="port-opt.html#global-minimum-variance-portfolio-gmvp"><i class="fa fa-check"></i><b>4.3.1</b> Global minimum variance portfolio (GMVP)</a></li>
<li class="chapter" data-level="4.3.2" data-path="port-opt.html"><a href="port-opt.html#inverse-volatility-portfolio-ivp"><i class="fa fa-check"></i><b>4.3.2</b> Inverse volatility portfolio (IVP)</a></li>
<li class="chapter" data-level="4.3.3" data-path="port-opt.html"><a href="port-opt.html#risk-parity-portfolio-rpp-or-equal-risk-portfolio-erp"><i class="fa fa-check"></i><b>4.3.3</b> Risk parity portfolio (RPP) or equal risk portfolio (ERP)</a></li>
<li class="chapter" data-level="4.3.4" data-path="port-opt.html"><a href="port-opt.html#most-diversified-portfolio-mdp"><i class="fa fa-check"></i><b>4.3.4</b> Most diversified portfolio (MDP)</a></li>
<li class="chapter" data-level="4.3.5" data-path="port-opt.html"><a href="port-opt.html#maximum-decorrelation-portfolio-mdcp"><i class="fa fa-check"></i><b>4.3.5</b> Maximum decorrelation portfolio (MDCP)</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="port-opt.html"><a href="port-opt.html#comparison_chap4"><i class="fa fa-check"></i><b>4.4</b> Comparison</a></li>
<li class="chapter" data-level="4.5" data-path="port-opt.html"><a href="port-opt.html#rebalancing-frequencies"><i class="fa fa-check"></i><b>4.5</b> Rebalancing frequencies</a></li>
<li class="chapter" data-level="4.6" data-path="port-opt.html"><a href="port-opt.html#rolling-window-portfolios"><i class="fa fa-check"></i><b>4.6</b> Rolling window portfolios</a></li>
<li class="chapter" data-level="4.7" data-path="port-opt.html"><a href="port-opt.html#todo"><i class="fa fa-check"></i><b>4.7</b> TODO</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="factor-investing.html"><a href="factor-investing.html"><i class="fa fa-check"></i><b>5</b> Factor investing</a><ul>
<li class="chapter" data-level="5.1" data-path="factor-investing.html"><a href="factor-investing.html#factor-overview"><i class="fa fa-check"></i><b>5.1</b> Factor overview</a></li>
<li class="chapter" data-level="5.2" data-path="factor-investing.html"><a href="factor-investing.html#macroeconomic-factor"><i class="fa fa-check"></i><b>5.2</b> Macroeconomic factor</a><ul>
<li class="chapter" data-level="5.2.1" data-path="factor-investing.html"><a href="factor-investing.html#ls-fitting-simple-form"><i class="fa fa-check"></i><b>5.2.1</b> LS fitting – simple form</a></li>
<li class="chapter" data-level="5.2.2" data-path="factor-investing.html"><a href="factor-investing.html#ls-fitting-matrix-form"><i class="fa fa-check"></i><b>5.2.2</b> LS fitting – matrix form</a></li>
<li class="chapter" data-level="5.2.3" data-path="factor-investing.html"><a href="factor-investing.html#estimating-covriacne"><i class="fa fa-check"></i><b>5.2.3</b> Estimating covriacne</a></li>
<li class="chapter" data-level="5.2.4" data-path="factor-investing.html"><a href="factor-investing.html#evaluating-etfs-performance"><i class="fa fa-check"></i><b>5.2.4</b> Evaluating ETFs performance</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="factor-investing.html"><a href="factor-investing.html#fama-french"><i class="fa fa-check"></i><b>5.3</b> Fama-French</a></li>
<li class="chapter" data-level="5.4" data-path="factor-investing.html"><a href="factor-investing.html#statisticalprincipal-factor-models"><i class="fa fa-check"></i><b>5.4</b> Statistical/principal factor models</a></li>
<li class="chapter" data-level="5.5" data-path="factor-investing.html"><a href="factor-investing.html#comparison-of-covariance-matrix-estimations"><i class="fa fa-check"></i><b>5.5</b> Comparison of covariance matrix estimations</a></li>
<li class="chapter" data-level="5.6" data-path="factor-investing.html"><a href="factor-investing.html#edhec-smart-beta"><i class="fa fa-check"></i><b>5.6</b> Edhec smart beta</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html"><i class="fa fa-check"></i><b>6</b> Robust portfolio design</a><ul>
<li class="chapter" data-level="6.1" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#motivationChapt6"><i class="fa fa-check"></i><b>6.1</b> Motivation</a></li>
<li class="chapter" data-level="6.2" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#sensitivity-of-different-portfolio-design"><i class="fa fa-check"></i><b>6.2</b> Sensitivity of different portfolio design</a><ul>
<li class="chapter" data-level="6.2.1" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#global-maximum-return-portfolio"><i class="fa fa-check"></i><b>6.2.1</b> Global Maximum Return Portfolio</a></li>
<li class="chapter" data-level="6.2.2" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#global-minimum-variance-portfolio"><i class="fa fa-check"></i><b>6.2.2</b> Global Minimum Variance Portfolio</a></li>
<li class="chapter" data-level="6.2.3" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#markowitzs-mean-variance-portfolio"><i class="fa fa-check"></i><b>6.2.3</b> Markowitz’s mean-variance portfolio</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#robust-portfolio-optimization"><i class="fa fa-check"></i><b>6.3</b> Robust portfolio optimization</a><ul>
<li class="chapter" data-level="6.3.1" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#worst-case-robust-gmrp"><i class="fa fa-check"></i><b>6.3.1</b> Worst-case robust GMRP</a></li>
<li class="chapter" data-level="6.3.2" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#worst-case-robust-gmvp"><i class="fa fa-check"></i><b>6.3.2</b> Worst-case robust GMVP</a></li>
<li class="chapter" data-level="6.3.3" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#worst-case-markowitzs-portfolio"><i class="fa fa-check"></i><b>6.3.3</b> Worst-case Markowitz’s portfolio</a></li>
<li class="chapter" data-level="6.3.4" data-path="robust-portfolio-design.html"><a href="robust-portfolio-design.html#variance-uncertainty-based-on-factor-model"><i class="fa fa-check"></i><b>6.3.4</b> Variance uncertainty based on factor model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html"><i class="fa fa-check"></i><b>7</b> Alternative risk measure</a><ul>
<li class="chapter" data-level="7.1" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#motivation_alter_risk_measure"><i class="fa fa-check"></i><b>7.1</b> Motivation</a></li>
<li class="chapter" data-level="7.2" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#risk-measure"><i class="fa fa-check"></i><b>7.2</b> Risk measure</a></li>
<li class="chapter" data-level="7.3" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#alternative-risk-measure-beased-portfolio"><i class="fa fa-check"></i><b>7.3</b> Alternative risk measure beased portfolio</a><ul>
<li class="chapter" data-level="7.3.1" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean-downside-risk-portfolio"><i class="fa fa-check"></i><b>7.3.1</b> Mean-downside risk portfolio</a></li>
<li class="chapter" data-level="7.3.2" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean-cvar-portfolio"><i class="fa fa-check"></i><b>7.3.2</b> Mean-CVaR portfolio</a></li>
<li class="chapter" data-level="7.3.3" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean---max-dd-portfolio"><i class="fa fa-check"></i><b>7.3.3</b> Mean - Max-DD portfolio</a></li>
<li class="chapter" data-level="7.3.4" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean---ave-dd-portfolio"><i class="fa fa-check"></i><b>7.3.4</b> Mean - Ave-DD portfolio</a></li>
<li class="chapter" data-level="7.3.5" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#mean-cdar-portfolio"><i class="fa fa-check"></i><b>7.3.5</b> Mean-CDaR portfolio</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#comparison-of-dr-cvar-and-dd-portfolios"><i class="fa fa-check"></i><b>7.4</b> Comparison of DR, CVaR, and DD portfolios</a></li>
<li class="chapter" data-level="7.5" data-path="alternative-risk-measure.html"><a href="alternative-risk-measure.html#alter_con"><i class="fa fa-check"></i><b>7.5</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html"><i class="fa fa-check"></i><b>8</b> Risk parity portfolio</a><ul>
<li class="chapter" data-level="8.1" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#motiv_risk_parity"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#formulation"><i class="fa fa-check"></i><b>8.2</b> Formulation</a></li>
<li class="chapter" data-level="8.3" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#risk-budgeting-portfolio-rbp"><i class="fa fa-check"></i><b>8.3</b> Risk budgeting portfolio (RBP)</a><ul>
<li class="chapter" data-level="8.3.1" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#naive-risk-budgeting-portfolio"><i class="fa fa-check"></i><b>8.3.1</b> Naive risk budgeting portfolio</a></li>
<li class="chapter" data-level="8.3.2" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#inverse-volatility-portfolio"><i class="fa fa-check"></i><b>8.3.2</b> Inverse volatility portfolio</a></li>
<li class="chapter" data-level="8.3.3" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#pnl-comparison"><i class="fa fa-check"></i><b>8.3.3</b> PnL comparison</a></li>
<li class="chapter" data-level="8.3.4" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#vanilla-rpp"><i class="fa fa-check"></i><b>8.3.4</b> vanilla RPP</a></li>
<li class="chapter" data-level="8.3.5" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#rpp-general-formulation"><i class="fa fa-check"></i><b>8.3.5</b> RPP: General formulation</a></li>
<li class="chapter" data-level="8.3.6" data-path="risk-parity-portfolio.html"><a href="risk-parity-portfolio.html#rbp-formulations"><i class="fa fa-check"></i><b>8.3.6</b> RBP formulations</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Portfolio Construction</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="risk-parity-portfolio" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Risk parity portfolio</h1>
<div id="motiv_risk_parity" class="section level2">
<h2><span class="header-section-number">8.1</span> Motivation</h2>
<p>Since the global financial crisis in 2008, risk management has particularly become more important than performance management in portfolio optimization.</p>
<p>This chapter is for improvement of the last issue of Markowitz’s portfolio: it only considers the risk of the portfolio as a whole and ignores the risk diversification (i.e., concentrates risk too much in few assets, this was observed in the 2008 financial crisis): solution is the risk parity portfolio.</p>
<p>The alternative risk parity portfolio design has been receiving significant attention from both the theoretical and practical sides because it<br />
- diversifies the risk, instead of the capital, among the assets
- is less sensitive to parameter estimation errors.</p>
<p>Today, pension funds and institutional investors are using this approach in the development of smart indexing and the redefinition of long-term investment policies.</p>
<p>The risk parity approach asserts that when asset allocations are adjusted to the same risk level, the portfolio can achieve a higher Sharpe ratio and can be more resistant to market downturns.</p>
<p>Facts: Lack of diversification of Markowitz portfolio</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="risk-parity-portfolio.html#cb1-1"></a>from =<span class="st"> &quot;2014-01-01&quot;</span></span>
<span id="cb1-2"><a href="risk-parity-portfolio.html#cb1-2"></a>to =<span class="st"> &quot;2016-12-31&quot;</span></span>
<span id="cb1-3"><a href="risk-parity-portfolio.html#cb1-3"></a>tickers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AAPL&quot;</span>, <span class="st">&quot;AMD&quot;</span>, <span class="st">&quot;ADI&quot;</span>,  <span class="st">&quot;ABBV&quot;</span>, <span class="st">&quot;AEZS&quot;</span>, <span class="st">&quot;A&quot;</span>,  <span class="st">&quot;APD&quot;</span>, <span class="st">&quot;AA&quot;</span>,<span class="st">&quot;CF&quot;</span>)</span>
<span id="cb1-4"><a href="risk-parity-portfolio.html#cb1-4"></a>prices &lt;-<span class="st"> </span><span class="kw">get_data</span>(tickers, from, to)</span>
<span id="cb1-5"><a href="risk-parity-portfolio.html#cb1-5"></a>N &lt;-<span class="st"> </span><span class="kw">ncol</span>(prices)</span>
<span id="cb1-6"><a href="risk-parity-portfolio.html#cb1-6"></a>T &lt;-<span class="st"> </span><span class="kw">nrow</span>(prices)</span>
<span id="cb1-7"><a href="risk-parity-portfolio.html#cb1-7"></a>T_trn &lt;-<span class="st"> </span><span class="kw">round</span>(T<span class="op">*</span><span class="fl">0.7</span>)</span>
<span id="cb1-8"><a href="risk-parity-portfolio.html#cb1-8"></a>X &lt;-<span class="st"> </span><span class="kw">diff</span>(<span class="kw">log</span>(prices)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">na.omit</span>()</span>
<span id="cb1-9"><a href="risk-parity-portfolio.html#cb1-9"></a></span>
<span id="cb1-10"><a href="risk-parity-portfolio.html#cb1-10"></a>temp &lt;-<span class="st"> </span><span class="kw">get_return_and_split</span>(<span class="dt">ratio=</span><span class="fl">0.7</span>, <span class="dt">prices=</span>prices)</span>
<span id="cb1-11"><a href="risk-parity-portfolio.html#cb1-11"></a>X_log_trn &lt;-<span class="st"> </span>temp<span class="op">$</span>log_trn</span>
<span id="cb1-12"><a href="risk-parity-portfolio.html#cb1-12"></a>X_log_tst &lt;-<span class="st"> </span>temp<span class="op">$</span>log_tst</span>
<span id="cb1-13"><a href="risk-parity-portfolio.html#cb1-13"></a>X_lin_trn &lt;-<span class="st"> </span>temp<span class="op">$</span>lin_trn</span>
<span id="cb1-14"><a href="risk-parity-portfolio.html#cb1-14"></a>X_lin_tst &lt;-<span class="st"> </span>temp<span class="op">$</span>lin_tst</span>
<span id="cb1-15"><a href="risk-parity-portfolio.html#cb1-15"></a>X_lin     &lt;-<span class="st"> </span>temp<span class="op">$</span>X_lin</span>
<span id="cb1-16"><a href="risk-parity-portfolio.html#cb1-16"></a>X_log     &lt;-<span class="st"> </span>temp<span class="op">$</span>X_log</span>
<span id="cb1-17"><a href="risk-parity-portfolio.html#cb1-17"></a>mu &lt;-<span class="st"> </span><span class="kw">colMeans</span>(X)</span>
<span id="cb1-18"><a href="risk-parity-portfolio.html#cb1-18"></a>Sigma &lt;-<span class="st"> </span><span class="kw">cov</span>(X)</span>
<span id="cb1-19"><a href="risk-parity-portfolio.html#cb1-19"></a><span class="kw">plot</span>(prices<span class="op">/</span><span class="kw">rep</span>(prices[<span class="dv">1</span>, ], <span class="dt">each =</span> <span class="kw">nrow</span>(prices)), <span class="dt">col =</span> rainbow10equal, <span class="dt">legend.loc =</span> <span class="st">&quot;topleft&quot;</span>,<span class="dt">main =</span> <span class="st">&quot;Normalized prices&quot;</span>)</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-4-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="risk-parity-portfolio.html#cb2-1"></a><span class="co"># define portfolio formulations</span></span>
<span id="cb2-2"><a href="risk-parity-portfolio.html#cb2-2"></a>portolioMarkowitz &lt;-<span class="st"> </span><span class="cf">function</span>(mu, Sigma, <span class="dt">lmd =</span> <span class="fl">0.5</span>) {</span>
<span id="cb2-3"><a href="risk-parity-portfolio.html#cb2-3"></a>  w &lt;-<span class="st"> </span><span class="kw">Variable</span>(<span class="kw">nrow</span>(Sigma))</span>
<span id="cb2-4"><a href="risk-parity-portfolio.html#cb2-4"></a>  prob &lt;-<span class="st"> </span><span class="kw">Problem</span>(<span class="kw">Maximize</span>(<span class="kw">t</span>(mu) <span class="op">%*%</span><span class="st"> </span>w <span class="op">-</span><span class="st"> </span>lmd<span class="op">*</span><span class="kw">quad_form</span>(w, Sigma)),</span>
<span id="cb2-5"><a href="risk-parity-portfolio.html#cb2-5"></a>                  <span class="dt">constraints =</span> <span class="kw">list</span>(w <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">sum</span>(w) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb2-6"><a href="risk-parity-portfolio.html#cb2-6"></a>  result &lt;-<span class="st"> </span><span class="kw">solve</span>(prob)</span>
<span id="cb2-7"><a href="risk-parity-portfolio.html#cb2-7"></a>  <span class="kw">return</span>(<span class="kw">as.vector</span>(result<span class="op">$</span><span class="kw">getValue</span>(w)))</span>
<span id="cb2-8"><a href="risk-parity-portfolio.html#cb2-8"></a>}</span>
<span id="cb2-9"><a href="risk-parity-portfolio.html#cb2-9"></a></span>
<span id="cb2-10"><a href="risk-parity-portfolio.html#cb2-10"></a>portolioGMVP &lt;-<span class="st"> </span><span class="cf">function</span>(Sigma) {</span>
<span id="cb2-11"><a href="risk-parity-portfolio.html#cb2-11"></a>  w &lt;-<span class="st"> </span><span class="kw">Variable</span>(<span class="kw">nrow</span>(Sigma))</span>
<span id="cb2-12"><a href="risk-parity-portfolio.html#cb2-12"></a>  prob &lt;-<span class="st"> </span><span class="kw">Problem</span>(<span class="kw">Minimize</span>(<span class="kw">quad_form</span>(w, Sigma)), </span>
<span id="cb2-13"><a href="risk-parity-portfolio.html#cb2-13"></a>                  <span class="dt">constraints =</span> <span class="kw">list</span>(w <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">sum</span>(w) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb2-14"><a href="risk-parity-portfolio.html#cb2-14"></a>  result &lt;-<span class="st"> </span><span class="kw">solve</span>(prob)</span>
<span id="cb2-15"><a href="risk-parity-portfolio.html#cb2-15"></a>  <span class="kw">return</span>(<span class="kw">as.vector</span>(result<span class="op">$</span><span class="kw">getValue</span>(w)))</span>
<span id="cb2-16"><a href="risk-parity-portfolio.html#cb2-16"></a>}</span>
<span id="cb2-17"><a href="risk-parity-portfolio.html#cb2-17"></a></span>
<span id="cb2-18"><a href="risk-parity-portfolio.html#cb2-18"></a><span class="co"># compute portfolios</span></span>
<span id="cb2-19"><a href="risk-parity-portfolio.html#cb2-19"></a>w_Markowitz &lt;-<span class="st"> </span><span class="kw">portolioMarkowitz</span>(mu, Sigma)</span>
<span id="cb2-20"><a href="risk-parity-portfolio.html#cb2-20"></a>w_GMVP &lt;-<span class="st"> </span><span class="kw">portolioGMVP</span>(Sigma)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="risk-parity-portfolio.html#cb3-1"></a><span class="co"># put together all portfolios</span></span>
<span id="cb3-2"><a href="risk-parity-portfolio.html#cb3-2"></a>w_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(w_GMVP, w_Markowitz)</span>
<span id="cb3-3"><a href="risk-parity-portfolio.html#cb3-3"></a><span class="kw">rownames</span>(w_all) &lt;-<span class="st"> </span><span class="kw">colnames</span>(X_lin)</span>
<span id="cb3-4"><a href="risk-parity-portfolio.html#cb3-4"></a><span class="kw">colnames</span>(w_all) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;GMVP&quot;</span>, <span class="st">&quot;Markowitz MVP&quot;</span>)</span>
<span id="cb3-5"><a href="risk-parity-portfolio.html#cb3-5"></a></span>
<span id="cb3-6"><a href="risk-parity-portfolio.html#cb3-6"></a><span class="co"># plot</span></span>
<span id="cb3-7"><a href="risk-parity-portfolio.html#cb3-7"></a><span class="kw">barplot</span>(<span class="kw">t</span>(w_all), <span class="dt">col =</span> rainbow8equal[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>],</span>
<span id="cb3-8"><a href="risk-parity-portfolio.html#cb3-8"></a>        <span class="dt">main =</span> <span class="st">&quot;Portfolio allocation&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;stocks&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;dollars&quot;</span>, <span class="dt">beside =</span> <span class="ot">TRUE</span>, </span>
<span id="cb3-9"><a href="risk-parity-portfolio.html#cb3-9"></a>        <span class="dt">legend =</span> <span class="kw">colnames</span>(w_all))  <span class="co">#args.legend = list(x = &quot;topleft&quot;, inset = 0.04)</span></span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-6-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="risk-parity-portfolio.html#cb4-1"></a><span class="co"># compute returns of all portfolios</span></span>
<span id="cb4-2"><a href="risk-parity-portfolio.html#cb4-2"></a>ret_all &lt;-<span class="st"> </span><span class="kw">xts</span>(X_lin <span class="op">%*%</span><span class="st"> </span>w_all, <span class="kw">index</span>(X_lin))</span>
<span id="cb4-3"><a href="risk-parity-portfolio.html#cb4-3"></a>ret_all_trn &lt;-<span class="st"> </span>ret_all[<span class="dv">1</span><span class="op">:</span>T_trn, ]</span>
<span id="cb4-4"><a href="risk-parity-portfolio.html#cb4-4"></a>ret_all_tst &lt;-<span class="st"> </span>ret_all[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>T_trn), ]</span>
<span id="cb4-5"><a href="risk-parity-portfolio.html#cb4-5"></a></span>
<span id="cb4-6"><a href="risk-parity-portfolio.html#cb4-6"></a><span class="co"># performance in-sample</span></span>
<span id="cb4-7"><a href="risk-parity-portfolio.html#cb4-7"></a><span class="kw">t</span>(<span class="kw">table.AnnualizedReturns</span>(ret_all_trn))</span>
<span id="cb4-8"><a href="risk-parity-portfolio.html#cb4-8"></a><span class="co">#&gt;               Annualized Return Annualized Std Dev Annualized Sharpe (Rf=0%)</span></span>
<span id="cb4-9"><a href="risk-parity-portfolio.html#cb4-9"></a><span class="co">#&gt; GMVP                     0.0724             0.1774                    0.4084</span></span>
<span id="cb4-10"><a href="risk-parity-portfolio.html#cb4-10"></a><span class="co">#&gt; Markowitz MVP           -0.1342             0.3500                   -0.3834</span></span>
<span id="cb4-11"><a href="risk-parity-portfolio.html#cb4-11"></a><span class="co"># performance out-of-sample</span></span>
<span id="cb4-12"><a href="risk-parity-portfolio.html#cb4-12"></a><span class="kw">t</span>(<span class="kw">table.AnnualizedReturns</span>(ret_all_tst))</span>
<span id="cb4-13"><a href="risk-parity-portfolio.html#cb4-13"></a><span class="co">#&gt;               Annualized Return Annualized Std Dev Annualized Sharpe (Rf=0%)</span></span>
<span id="cb4-14"><a href="risk-parity-portfolio.html#cb4-14"></a><span class="co">#&gt; GMVP                     0.3003             0.1420                    2.1140</span></span>
<span id="cb4-15"><a href="risk-parity-portfolio.html#cb4-15"></a><span class="co">#&gt; Markowitz MVP            3.0480             0.5314                    5.7361</span></span>
<span id="cb4-16"><a href="risk-parity-portfolio.html#cb4-16"></a>{ <span class="kw">chart.CumReturns</span>(ret_all, <span class="dt">main =</span> <span class="st">&quot;Performance of different portfolios&quot;</span>, </span>
<span id="cb4-17"><a href="risk-parity-portfolio.html#cb4-17"></a>                   <span class="dt">wealth.index =</span> <span class="ot">TRUE</span>, <span class="dt">legend.loc =</span> <span class="st">&quot;topleft&quot;</span>, <span class="dt">colorset =</span> rich8equal)</span>
<span id="cb4-18"><a href="risk-parity-portfolio.html#cb4-18"></a>  <span class="kw">addEventLines</span>(<span class="kw">xts</span>(<span class="st">&quot;training&quot;</span>, <span class="kw">index</span>(X_lin[T_trn])), <span class="dt">srt=</span><span class="dv">90</span>, <span class="dt">pos=</span><span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkblue&quot;</span>) }</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-7-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="risk-parity-portfolio.html#cb5-1"></a>{ <span class="kw">chart.Drawdown</span>(ret_all, <span class="dt">main =</span> <span class="st">&quot;Drawdown of different portfolios&quot;</span>, </span>
<span id="cb5-2"><a href="risk-parity-portfolio.html#cb5-2"></a>                 <span class="dt">legend.loc =</span> <span class="st">&quot;bottomleft&quot;</span>, <span class="dt">colorset =</span> rich8equal)</span>
<span id="cb5-3"><a href="risk-parity-portfolio.html#cb5-3"></a>  <span class="kw">addEventLines</span>(<span class="kw">xts</span>(<span class="st">&quot;training&quot;</span>, <span class="kw">index</span>(X_lin[T_trn])), <span class="dt">srt=</span><span class="dv">90</span>, <span class="dt">pos=</span><span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkblue&quot;</span>) }</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-7-2.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="formulation" class="section level2">
<h2><span class="header-section-number">8.2</span> Formulation</h2>
<p>marginal risk contribution (MRC):</p>
<p><span class="math display">\[{\sf MRC}_i = \frac{\partial \sigma}{\partial w_i} = \frac{\left(\boldsymbol{\Sigma}\mathbf{w}\right)_i}{\sqrt{\mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}}}\]</span>
MRC can be defined based on other risk measures, like VaR and CVaR.</p>
<p>risk contribution (RC):</p>
<p><span class="math display">\[{\sf RC}_i = w_i\frac{\partial\sigma}{\partial w_i}=\frac{w_i\left(\boldsymbol{\Sigma}\mathbf{w}\right)_i}{\sqrt{\mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}}}\]</span></p>
<p>relative risk contribution (RRC):</p>
<p><span class="math display">\[{\sf RRC}_i = \frac{{\sf RC}_i}{\sigma(\mathbf{w})} = \frac{w_i\left(\boldsymbol{\Sigma}\mathbf{w}\right)_i}{\mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}}\]</span></p>
<p>note that <span class="math inline">\(\sum_{i=1}^N {\sf RRC}_i = 1\)</span></p>
</div>
<div id="risk-budgeting-portfolio-rbp" class="section level2">
<h2><span class="header-section-number">8.3</span> Risk budgeting portfolio (RBP)</h2>
<p>Risk budgeting portfolio (RBP) allocates the risk according to the risk profile determined by the weights <span class="math inline">\(\mathbf{b}\)</span></p>
<p><span class="math display">\[{\sf RC}_i = b_i \sigma(\mathbf{w})\]</span></p>
<p>We can rewrite</p>
<p><span class="math display">\[w_i\left(\boldsymbol{\Sigma}\mathbf{w}\right)_i = b_i \mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}, \qquad i=1,\ldots,N.\]</span></p>
<div id="naive-risk-budgeting-portfolio" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Naive risk budgeting portfolio</h3>
<p>assuming a diagonal covariance matrix</p>
</div>
<div id="inverse-volatility-portfolio" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Inverse volatility portfolio</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="risk-parity-portfolio.html#cb6-1"></a><span class="co"># compute EWP</span></span>
<span id="cb6-2"><a href="risk-parity-portfolio.html#cb6-2"></a>w_EWP &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span>N, N)</span>
<span id="cb6-3"><a href="risk-parity-portfolio.html#cb6-3"></a></span>
<span id="cb6-4"><a href="risk-parity-portfolio.html#cb6-4"></a><span class="co"># compute naive RPP</span></span>
<span id="cb6-5"><a href="risk-parity-portfolio.html#cb6-5"></a>sigma2 &lt;-<span class="st"> </span><span class="kw">diag</span>(Sigma)</span>
<span id="cb6-6"><a href="risk-parity-portfolio.html#cb6-6"></a>w_RPP_naive &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(sigma2)</span>
<span id="cb6-7"><a href="risk-parity-portfolio.html#cb6-7"></a>w_RPP_naive &lt;-<span class="st"> </span>w_RPP_naive<span class="op">/</span><span class="kw">sum</span>(w_RPP_naive)</span>
<span id="cb6-8"><a href="risk-parity-portfolio.html#cb6-8"></a></span>
<span id="cb6-9"><a href="risk-parity-portfolio.html#cb6-9"></a><span class="co"># add portfolios to the two previous ones</span></span>
<span id="cb6-10"><a href="risk-parity-portfolio.html#cb6-10"></a>w_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(w_all, </span>
<span id="cb6-11"><a href="risk-parity-portfolio.html#cb6-11"></a>               <span class="st">&quot;EWP&quot;</span>         =<span class="st"> </span>w_EWP,</span>
<span id="cb6-12"><a href="risk-parity-portfolio.html#cb6-12"></a>               <span class="st">&quot;RPP (naive)&quot;</span> =<span class="st"> </span>w_RPP_naive)  </span>
<span id="cb6-13"><a href="risk-parity-portfolio.html#cb6-13"></a></span>
<span id="cb6-14"><a href="risk-parity-portfolio.html#cb6-14"></a><span class="co"># plot</span></span>
<span id="cb6-15"><a href="risk-parity-portfolio.html#cb6-15"></a><span class="kw">barplot</span>(<span class="kw">t</span>(w_all), <span class="dt">col =</span> rainbow8equal[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>],</span>
<span id="cb6-16"><a href="risk-parity-portfolio.html#cb6-16"></a>        <span class="dt">main =</span> <span class="st">&quot;Portfolio allocation&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;stocks&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;dollars&quot;</span>, <span class="dt">beside =</span> <span class="ot">TRUE</span>, </span>
<span id="cb6-17"><a href="risk-parity-portfolio.html#cb6-17"></a>        <span class="dt">legend =</span> <span class="kw">colnames</span>(w_all))</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Let’s plot the risk contribution:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="risk-parity-portfolio.html#cb7-1"></a><span class="co"># compute risk contributions</span></span>
<span id="cb7-2"><a href="risk-parity-portfolio.html#cb7-2"></a>risk_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="st">&quot;GMVP&quot;</span>          =<span class="st"> </span><span class="kw">as.vector</span>(w_GMVP <span class="op">*</span><span class="st"> </span>(Sigma <span class="op">%*%</span><span class="st"> </span>w_GMVP)),</span>
<span id="cb7-3"><a href="risk-parity-portfolio.html#cb7-3"></a>                  <span class="st">&quot;Markowitz MVP&quot;</span> =<span class="st"> </span><span class="kw">as.vector</span>(w_Markowitz <span class="op">*</span><span class="st"> </span>(Sigma <span class="op">%*%</span><span class="st"> </span>w_Markowitz)),</span>
<span id="cb7-4"><a href="risk-parity-portfolio.html#cb7-4"></a>                  <span class="st">&quot;EWP&quot;</span>           =<span class="st"> </span><span class="kw">as.vector</span>(w_EWP <span class="op">*</span><span class="st"> </span>(Sigma <span class="op">%*%</span><span class="st"> </span>w_EWP)),</span>
<span id="cb7-5"><a href="risk-parity-portfolio.html#cb7-5"></a>                  <span class="st">&quot;RPP (naive)&quot;</span>    =<span class="st"> </span><span class="kw">as.vector</span>(w_RPP_naive <span class="op">*</span><span class="st"> </span>(Sigma <span class="op">%*%</span><span class="st"> </span>w_RPP_naive)))</span>
<span id="cb7-6"><a href="risk-parity-portfolio.html#cb7-6"></a><span class="kw">rownames</span>(risk_all) &lt;-<span class="st"> </span><span class="kw">colnames</span>(X_lin)</span>
<span id="cb7-7"><a href="risk-parity-portfolio.html#cb7-7"></a>RRC_all &lt;-<span class="st"> </span><span class="kw">sweep</span>(risk_all, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">STATS =</span> <span class="kw">colSums</span>(risk_all), <span class="dt">FUN =</span> <span class="st">&quot;/&quot;</span>)  <span class="co"># normalize each column</span></span>
<span id="cb7-8"><a href="risk-parity-portfolio.html#cb7-8"></a></span>
<span id="cb7-9"><a href="risk-parity-portfolio.html#cb7-9"></a><span class="co"># plot</span></span>
<span id="cb7-10"><a href="risk-parity-portfolio.html#cb7-10"></a><span class="kw">barplot</span>(<span class="kw">t</span>(RRC_all), <span class="dt">col =</span> rainbow8equal[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>],</span>
<span id="cb7-11"><a href="risk-parity-portfolio.html#cb7-11"></a>        <span class="dt">main =</span> <span class="st">&quot;Relative risk contribution&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;stocks&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;risk&quot;</span>, <span class="dt">beside =</span> <span class="ot">TRUE</span>, <span class="dt">legend =</span> <span class="kw">colnames</span>(RRC_all))</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="pnl-comparison" class="section level3">
<h3><span class="header-section-number">8.3.3</span> PnL comparison</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="risk-parity-portfolio.html#cb8-1"></a><span class="co"># compute returns of all portfolios</span></span>
<span id="cb8-2"><a href="risk-parity-portfolio.html#cb8-2"></a>ret_all &lt;-<span class="st"> </span><span class="kw">xts</span>(X_lin <span class="op">%*%</span><span class="st"> </span>w_all[, <span class="kw">c</span>(<span class="st">&quot;GMVP&quot;</span>, <span class="st">&quot;Markowitz MVP&quot;</span>, <span class="st">&quot;EWP&quot;</span>, <span class="st">&quot;RPP (naive)&quot;</span>)], </span>
<span id="cb8-3"><a href="risk-parity-portfolio.html#cb8-3"></a>               <span class="dt">order.by =</span> <span class="kw">index</span>(X_lin))</span>
<span id="cb8-4"><a href="risk-parity-portfolio.html#cb8-4"></a>ret_all_trn &lt;-<span class="st"> </span>ret_all[<span class="dv">1</span><span class="op">:</span>T_trn, ]</span>
<span id="cb8-5"><a href="risk-parity-portfolio.html#cb8-5"></a>ret_all_tst &lt;-<span class="st"> </span>ret_all[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>T_trn), ]</span>
<span id="cb8-6"><a href="risk-parity-portfolio.html#cb8-6"></a></span>
<span id="cb8-7"><a href="risk-parity-portfolio.html#cb8-7"></a><span class="kw">t</span>(<span class="kw">table.AnnualizedReturns</span>(ret_all_trn))</span>
<span id="cb8-8"><a href="risk-parity-portfolio.html#cb8-8"></a><span class="co">#&gt;               Annualized Return Annualized Std Dev Annualized Sharpe (Rf=0%)</span></span>
<span id="cb8-9"><a href="risk-parity-portfolio.html#cb8-9"></a><span class="co">#&gt; GMVP                     0.0724             0.1774                    0.4084</span></span>
<span id="cb8-10"><a href="risk-parity-portfolio.html#cb8-10"></a><span class="co">#&gt; Markowitz MVP           -0.1342             0.3500                   -0.3834</span></span>
<span id="cb8-11"><a href="risk-parity-portfolio.html#cb8-11"></a><span class="co">#&gt; EWP                     -0.1221             0.2569                   -0.4753</span></span>
<span id="cb8-12"><a href="risk-parity-portfolio.html#cb8-12"></a><span class="co">#&gt; RPP (naive)             -0.0157             0.1874                   -0.0838</span></span>
<span id="cb8-13"><a href="risk-parity-portfolio.html#cb8-13"></a><span class="kw">t</span>(<span class="kw">table.AnnualizedReturns</span>(ret_all_tst))</span>
<span id="cb8-14"><a href="risk-parity-portfolio.html#cb8-14"></a><span class="co">#&gt;               Annualized Return Annualized Std Dev Annualized Sharpe (Rf=0%)</span></span>
<span id="cb8-15"><a href="risk-parity-portfolio.html#cb8-15"></a><span class="co">#&gt; GMVP                     0.3003             0.1420                    2.1140</span></span>
<span id="cb8-16"><a href="risk-parity-portfolio.html#cb8-16"></a><span class="co">#&gt; Markowitz MVP            3.0480             0.5314                    5.7361</span></span>
<span id="cb8-17"><a href="risk-parity-portfolio.html#cb8-17"></a><span class="co">#&gt; EWP                      0.7190             0.2252                    3.1933</span></span>
<span id="cb8-18"><a href="risk-parity-portfolio.html#cb8-18"></a><span class="co">#&gt; RPP (naive)              0.5346             0.1809                    2.9543</span></span>
<span id="cb8-19"><a href="risk-parity-portfolio.html#cb8-19"></a></span>
<span id="cb8-20"><a href="risk-parity-portfolio.html#cb8-20"></a>{ <span class="kw">chart.CumReturns</span>(ret_all, <span class="dt">main =</span> <span class="st">&quot;Cum PnL of different portfolios&quot;</span>, </span>
<span id="cb8-21"><a href="risk-parity-portfolio.html#cb8-21"></a>                   <span class="dt">wealth.index =</span> <span class="ot">TRUE</span>, <span class="dt">legend.loc =</span> <span class="st">&quot;topleft&quot;</span>, <span class="dt">colorset =</span> rainbow8equal)</span>
<span id="cb8-22"><a href="risk-parity-portfolio.html#cb8-22"></a>  <span class="kw">addEventLines</span>(<span class="kw">xts</span>(<span class="st">&quot;training&quot;</span>, <span class="kw">index</span>(X_lin[T_trn])), <span class="dt">srt=</span><span class="dv">90</span>, <span class="dt">pos=</span><span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkblue&quot;</span>) }</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="risk-parity-portfolio.html#cb9-1"></a></span>
<span id="cb9-2"><a href="risk-parity-portfolio.html#cb9-2"></a>{ <span class="kw">chart.Drawdown</span>(ret_all, <span class="dt">main =</span> <span class="st">&quot;Drawdown of different portfolios&quot;</span>, </span>
<span id="cb9-3"><a href="risk-parity-portfolio.html#cb9-3"></a>                 <span class="dt">legend.loc =</span> <span class="st">&quot;bottomleft&quot;</span>, <span class="dt">colorset =</span> rainbow6equal)</span>
<span id="cb9-4"><a href="risk-parity-portfolio.html#cb9-4"></a>  <span class="kw">addEventLines</span>(<span class="kw">xts</span>(<span class="st">&quot;training&quot;</span>, <span class="kw">index</span>(X_lin[T_trn])), <span class="dt">srt=</span><span class="dv">90</span>, <span class="dt">pos=</span><span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkblue&quot;</span>) }</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-10-2.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="vanilla-rpp" class="section level3">
<h3><span class="header-section-number">8.3.4</span> vanilla RPP</h3>
<p>Solving the risk budgeting equations as a system of nonlinear equations</p>
<p><span class="math display">\[w_i\left(\boldsymbol{\Sigma}\mathbf{w}\right)_i = b_i \mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}, \qquad i=1,\ldots,N\]</span>
if we define <span class="math inline">\(\mathbf{x}=\mathbf{w}/\sqrt{\mathbf{w}^{T}\boldsymbol{\Sigma}\mathbf{w}}\)</span>,
<span class="math display">\[\boldsymbol{\Sigma}\mathbf{x} = \mathbf{b}/\mathbf{x}\]</span></p>
<p>Solving the risk budgeting equations as a system of nonlinear equations</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="risk-parity-portfolio.html#cb10-1"></a><span class="kw">library</span>(rootSolve)</span>
<span id="cb10-2"><a href="risk-parity-portfolio.html#cb10-2"></a>b &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span>N, N)</span>
<span id="cb10-3"><a href="risk-parity-portfolio.html#cb10-3"></a><span class="co"># function definition F(x) = Sigma %*% x - b/x</span></span>
<span id="cb10-4"><a href="risk-parity-portfolio.html#cb10-4"></a>f_root &lt;-<span class="st"> </span><span class="cf">function</span>(x, parms) {</span>
<span id="cb10-5"><a href="risk-parity-portfolio.html#cb10-5"></a>  Sigma &lt;-<span class="st"> </span>parms</span>
<span id="cb10-6"><a href="risk-parity-portfolio.html#cb10-6"></a>  N &lt;-<span class="st"> </span><span class="kw">nrow</span>(Sigma)</span>
<span id="cb10-7"><a href="risk-parity-portfolio.html#cb10-7"></a>  <span class="kw">return</span>(Sigma <span class="op">%*%</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span>b<span class="op">/</span>x)</span>
<span id="cb10-8"><a href="risk-parity-portfolio.html#cb10-8"></a>}</span>
<span id="cb10-9"><a href="risk-parity-portfolio.html#cb10-9"></a><span class="co"># finding the root</span></span>
<span id="cb10-10"><a href="risk-parity-portfolio.html#cb10-10"></a>x_root &lt;-<span class="st"> </span><span class="kw">multiroot</span>(f_root, <span class="dt">start =</span> b, <span class="dt">parms =</span> Sigma)<span class="op">$</span>root</span>
<span id="cb10-11"><a href="risk-parity-portfolio.html#cb10-11"></a>w_root &lt;-<span class="st"> </span>x_root<span class="op">/</span><span class="kw">sum</span>(x_root)</span>
<span id="cb10-12"><a href="risk-parity-portfolio.html#cb10-12"></a></span>
<span id="cb10-13"><a href="risk-parity-portfolio.html#cb10-13"></a>w_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(w_all, </span>
<span id="cb10-14"><a href="risk-parity-portfolio.html#cb10-14"></a>               <span class="st">&quot;RPP (root)&quot;</span> =<span class="st"> </span>w_root)</span>
<span id="cb10-15"><a href="risk-parity-portfolio.html#cb10-15"></a><span class="co"># compute risk contributions</span></span>
<span id="cb10-16"><a href="risk-parity-portfolio.html#cb10-16"></a>risk_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(risk_all, </span>
<span id="cb10-17"><a href="risk-parity-portfolio.html#cb10-17"></a>                  <span class="st">&quot;RPP (root)&quot;</span> =<span class="st"> </span><span class="kw">as.vector</span>(w_root <span class="op">*</span><span class="st"> </span>(Sigma <span class="op">%*%</span><span class="st"> </span>w_root)))</span>
<span id="cb10-18"><a href="risk-parity-portfolio.html#cb10-18"></a>RRC_all &lt;-<span class="st"> </span><span class="kw">sweep</span>(risk_all, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">STATS =</span> <span class="kw">colSums</span>(risk_all), <span class="dt">FUN =</span> <span class="st">&quot;/&quot;</span>)  <span class="co"># normalize each column</span></span>
<span id="cb10-19"><a href="risk-parity-portfolio.html#cb10-19"></a><span class="co"># plot</span></span>
<span id="cb10-20"><a href="risk-parity-portfolio.html#cb10-20"></a><span class="kw">barplot</span>(<span class="kw">t</span>(RRC_all), <span class="dt">col =</span> rainbow8equal[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>],</span>
<span id="cb10-21"><a href="risk-parity-portfolio.html#cb10-21"></a>        <span class="dt">main =</span> <span class="st">&quot;Relative risk contribution&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;stocks&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;risk&quot;</span>, <span class="dt">beside =</span> <span class="ot">TRUE</span>, <span class="dt">legend =</span> <span class="kw">colnames</span>(RRC_all))</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-11-1.png" width="80%" style="display: block; margin: auto;" />
Interestingly, Spinu (2013) realized that precisely the risk budgeting equation <span class="math inline">\(\boldsymbol{\Sigma}\mathbf{x} = \mathbf{b}/\mathbf{x}\)</span> corresponds to the gradient of the convex function <span class="math inline">\(f(\mathbf{x}) = \frac{1}{2}\mathbf{x}^{T}\boldsymbol{\Sigma}\mathbf{x} - \mathbf{b}^T\log(\mathbf{x})\)</span></p>
<p>Thus, we can finally formulate the risk budgeting problem as the following convex optimization problem:</p>
<p><span class="math display">\[\underset{\mathbf{x}\ge\mathbf{0}}{\textsf{minimize}} \quad \frac{1}{2}\mathbf{x}^{T}\boldsymbol{\Sigma}\mathbf{x} - \mathbf{b}^T\log(\mathbf{x})\]</span>
But if we really aim for speed and computational efficiency, there are simple iterative algorithms that can be tailored to the problem at hand, like the cyclical coordinate descent algorithm and the Newton algorithm.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="risk-parity-portfolio.html#cb11-1"></a><span class="co"># initial point</span></span>
<span id="cb11-2"><a href="risk-parity-portfolio.html#cb11-2"></a>x0 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span>N, N)</span>
<span id="cb11-3"><a href="risk-parity-portfolio.html#cb11-3"></a></span>
<span id="cb11-4"><a href="risk-parity-portfolio.html#cb11-4"></a><span class="co"># function definition</span></span>
<span id="cb11-5"><a href="risk-parity-portfolio.html#cb11-5"></a>fn_convex &lt;-<span class="st"> </span><span class="cf">function</span>(x, Sigma) {</span>
<span id="cb11-6"><a href="risk-parity-portfolio.html#cb11-6"></a>  N &lt;-<span class="st"> </span><span class="kw">nrow</span>(Sigma)</span>
<span id="cb11-7"><a href="risk-parity-portfolio.html#cb11-7"></a>  <span class="kw">return</span>(<span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">t</span>(x) <span class="op">%*%</span><span class="st"> </span>Sigma <span class="op">%*%</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>N)<span class="op">*</span><span class="kw">sum</span>(<span class="kw">log</span>(x)))</span>
<span id="cb11-8"><a href="risk-parity-portfolio.html#cb11-8"></a>}</span>
<span id="cb11-9"><a href="risk-parity-portfolio.html#cb11-9"></a></span>
<span id="cb11-10"><a href="risk-parity-portfolio.html#cb11-10"></a><span class="co"># optimize with general-purpose solver</span></span>
<span id="cb11-11"><a href="risk-parity-portfolio.html#cb11-11"></a>result &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dt">par =</span> x0, <span class="dt">fn =</span> fn_convex, <span class="dt">Sigma =</span> Sigma, <span class="dt">method =</span> <span class="st">&quot;BFGS&quot;</span>)</span>
<span id="cb11-12"><a href="risk-parity-portfolio.html#cb11-12"></a>x_convex &lt;-<span class="st"> </span>result<span class="op">$</span>par</span>
<span id="cb11-13"><a href="risk-parity-portfolio.html#cb11-13"></a>w_RPP_convex &lt;-<span class="st"> </span>x_convex<span class="op">/</span><span class="kw">sum</span>(x_convex)</span>
<span id="cb11-14"><a href="risk-parity-portfolio.html#cb11-14"></a></span>
<span id="cb11-15"><a href="risk-parity-portfolio.html#cb11-15"></a>b &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span>N, N)</span>
<span id="cb11-16"><a href="risk-parity-portfolio.html#cb11-16"></a>Sigma <span class="op">%*%</span><span class="st"> </span>x_convex <span class="op">-</span><span class="st"> </span>b<span class="op">/</span>x_convex</span>
<span id="cb11-17"><a href="risk-parity-portfolio.html#cb11-17"></a><span class="co">#&gt;               [,1]</span></span>
<span id="cb11-18"><a href="risk-parity-portfolio.html#cb11-18"></a><span class="co">#&gt; AAPL -3.188258e-05</span></span>
<span id="cb11-19"><a href="risk-parity-portfolio.html#cb11-19"></a><span class="co">#&gt; AMD  -7.931839e-05</span></span>
<span id="cb11-20"><a href="risk-parity-portfolio.html#cb11-20"></a><span class="co">#&gt; ADI  -1.077151e-05</span></span>
<span id="cb11-21"><a href="risk-parity-portfolio.html#cb11-21"></a><span class="co">#&gt; ABBV -9.341533e-06</span></span>
<span id="cb11-22"><a href="risk-parity-portfolio.html#cb11-22"></a><span class="co">#&gt; AEZS -3.580135e-05</span></span>
<span id="cb11-23"><a href="risk-parity-portfolio.html#cb11-23"></a><span class="co">#&gt; A    -2.433692e-06</span></span>
<span id="cb11-24"><a href="risk-parity-portfolio.html#cb11-24"></a><span class="co">#&gt; APD  -5.438662e-05</span></span>
<span id="cb11-25"><a href="risk-parity-portfolio.html#cb11-25"></a><span class="co">#&gt; AA    1.082228e-06</span></span>
<span id="cb11-26"><a href="risk-parity-portfolio.html#cb11-26"></a><span class="co">#&gt; CF   -9.610402e-06</span></span>
<span id="cb11-27"><a href="risk-parity-portfolio.html#cb11-27"></a></span>
<span id="cb11-28"><a href="risk-parity-portfolio.html#cb11-28"></a>w_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(w_all, <span class="st">&quot;RPP (convex)&quot;</span> =<span class="st"> </span>w_RPP_convex)</span>
<span id="cb11-29"><a href="risk-parity-portfolio.html#cb11-29"></a><span class="kw">barplot</span>(<span class="kw">t</span>(w_all), <span class="dt">col =</span> rainbow8equal[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>],</span>
<span id="cb11-30"><a href="risk-parity-portfolio.html#cb11-30"></a>        <span class="dt">main =</span> <span class="st">&quot;Portfolio allocation&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;stocks&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;dollars&quot;</span>, <span class="dt">beside =</span> <span class="ot">TRUE</span>, </span>
<span id="cb11-31"><a href="risk-parity-portfolio.html#cb11-31"></a>        <span class="dt">legend =</span> <span class="kw">colnames</span>(w_all))</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-12-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="risk-parity-portfolio.html#cb12-1"></a></span>
<span id="cb12-2"><a href="risk-parity-portfolio.html#cb12-2"></a><span class="co"># compute risk contributions</span></span>
<span id="cb12-3"><a href="risk-parity-portfolio.html#cb12-3"></a>risk_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(risk_all, </span>
<span id="cb12-4"><a href="risk-parity-portfolio.html#cb12-4"></a>                  <span class="st">&quot;RPP (convex)&quot;</span> =<span class="st"> </span><span class="kw">as.vector</span>(w_RPP_convex <span class="op">*</span><span class="st"> </span>(Sigma <span class="op">%*%</span><span class="st"> </span>w_RPP_convex)))</span>
<span id="cb12-5"><a href="risk-parity-portfolio.html#cb12-5"></a>RRC_all &lt;-<span class="st"> </span><span class="kw">sweep</span>(risk_all, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">STATS =</span> <span class="kw">colSums</span>(risk_all), <span class="dt">FUN =</span> <span class="st">&quot;/&quot;</span>)  <span class="co"># normalize each column</span></span>
<span id="cb12-6"><a href="risk-parity-portfolio.html#cb12-6"></a></span>
<span id="cb12-7"><a href="risk-parity-portfolio.html#cb12-7"></a><span class="co"># plot</span></span>
<span id="cb12-8"><a href="risk-parity-portfolio.html#cb12-8"></a><span class="kw">barplot</span>(<span class="kw">t</span>(RRC_all), <span class="dt">col =</span> rainbow8equal[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>],</span>
<span id="cb12-9"><a href="risk-parity-portfolio.html#cb12-9"></a>        <span class="dt">main =</span> <span class="st">&quot;Relative risk contribution&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;stocks&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;risk&quot;</span>, <span class="dt">beside =</span> <span class="ot">TRUE</span>, </span>
<span id="cb12-10"><a href="risk-parity-portfolio.html#cb12-10"></a>        <span class="dt">legend =</span> <span class="kw">colnames</span>(RRC_all))</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-12-2.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="rpp-general-formulation" class="section level3">
<h3><span class="header-section-number">8.3.5</span> RPP: General formulation</h3>
<p>In more general cases, we need more sophisticated formulations, which unfortunately are not convex. (like having other constraints like allowing shortselling or box constraints, or maximizing the expected return)</p>
<p><span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{minimize}} &amp; \sum_{i,j=1}^{N}\left(w_{i}\left(\boldsymbol{\Sigma}\mathbf{w}\right)_{i}-w_{j}\left(\boldsymbol{\Sigma}\mathbf{w}\right)_{j}\right)^{2}\\
\textsf{subject to} &amp; \mathbf{1}^T\mathbf{w}=1.
\end{array}\]</span></p>
<p>We will solve it with the general-purpose nonlinear solver optim() in R (but this is totally ignoring the constraints, so a better solver should be used)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="risk-parity-portfolio.html#cb13-1"></a><span class="co"># initial point</span></span>
<span id="cb13-2"><a href="risk-parity-portfolio.html#cb13-2"></a>x0 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span>N, N)</span>
<span id="cb13-3"><a href="risk-parity-portfolio.html#cb13-3"></a></span>
<span id="cb13-4"><a href="risk-parity-portfolio.html#cb13-4"></a><span class="co"># function definition</span></span>
<span id="cb13-5"><a href="risk-parity-portfolio.html#cb13-5"></a>fn_nonconvex &lt;-<span class="st"> </span><span class="cf">function</span>(w, Sigma) {</span>
<span id="cb13-6"><a href="risk-parity-portfolio.html#cb13-6"></a>  N &lt;-<span class="st"> </span><span class="kw">length</span>(w)</span>
<span id="cb13-7"><a href="risk-parity-portfolio.html#cb13-7"></a>  risks &lt;-<span class="st">  </span>w <span class="op">*</span><span class="st"> </span>(Sigma <span class="op">%*%</span><span class="st"> </span>w)</span>
<span id="cb13-8"><a href="risk-parity-portfolio.html#cb13-8"></a>  g &lt;-<span class="st"> </span><span class="kw">rep</span>(risks, <span class="dt">times =</span> N) <span class="op">-</span><span class="st"> </span><span class="kw">rep</span>(risks, <span class="dt">each =</span> N)</span>
<span id="cb13-9"><a href="risk-parity-portfolio.html#cb13-9"></a>  <span class="kw">return</span>(<span class="kw">sum</span>(g<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb13-10"><a href="risk-parity-portfolio.html#cb13-10"></a>}</span>
<span id="cb13-11"><a href="risk-parity-portfolio.html#cb13-11"></a></span>
<span id="cb13-12"><a href="risk-parity-portfolio.html#cb13-12"></a><span class="co"># optimize with general-purpose solver</span></span>
<span id="cb13-13"><a href="risk-parity-portfolio.html#cb13-13"></a>result &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dt">par =</span> x0, <span class="dt">fn =</span> fn_nonconvex, <span class="dt">Sigma =</span> Sigma, <span class="dt">method =</span> <span class="st">&quot;BFGS&quot;</span>)</span>
<span id="cb13-14"><a href="risk-parity-portfolio.html#cb13-14"></a>x_gen_solver &lt;-<span class="st"> </span>result<span class="op">$</span>par</span>
<span id="cb13-15"><a href="risk-parity-portfolio.html#cb13-15"></a>w_RPP_gen_solver &lt;-<span class="st"> </span>x_gen_solver<span class="op">/</span><span class="kw">sum</span>(x_gen_solver)</span>
<span id="cb13-16"><a href="risk-parity-portfolio.html#cb13-16"></a></span>
<span id="cb13-17"><a href="risk-parity-portfolio.html#cb13-17"></a><span class="co"># plot</span></span>
<span id="cb13-18"><a href="risk-parity-portfolio.html#cb13-18"></a>w_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(w_all, <span class="st">&quot;RPP (gen-solver)&quot;</span> =<span class="st"> </span>w_RPP_gen_solver)</span>
<span id="cb13-19"><a href="risk-parity-portfolio.html#cb13-19"></a><span class="kw">barplot</span>(<span class="kw">t</span>(w_all), <span class="dt">col =</span> rainbow8equal[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>],</span>
<span id="cb13-20"><a href="risk-parity-portfolio.html#cb13-20"></a>        <span class="dt">main =</span> <span class="st">&quot;Portfolio allocation&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;stocks&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;dollars&quot;</span>, <span class="dt">beside =</span> <span class="ot">TRUE</span>, </span>
<span id="cb13-21"><a href="risk-parity-portfolio.html#cb13-21"></a>        <span class="dt">legend =</span> <span class="kw">colnames</span>(w_all))</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-13-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="risk-parity-portfolio.html#cb14-1"></a></span>
<span id="cb14-2"><a href="risk-parity-portfolio.html#cb14-2"></a><span class="co"># compute risk contributions</span></span>
<span id="cb14-3"><a href="risk-parity-portfolio.html#cb14-3"></a>risk_all &lt;-<span class="st"> </span><span class="kw">cbind</span>(risk_all, </span>
<span id="cb14-4"><a href="risk-parity-portfolio.html#cb14-4"></a>                  <span class="st">&quot;RPP (gen-solver)&quot;</span> =<span class="st"> </span><span class="kw">as.vector</span>(w_RPP_gen_solver <span class="op">*</span><span class="st"> </span>(Sigma <span class="op">%*%</span><span class="st"> </span>w_RPP_gen_solver)))</span>
<span id="cb14-5"><a href="risk-parity-portfolio.html#cb14-5"></a>RRC_all &lt;-<span class="st"> </span><span class="kw">sweep</span>(risk_all, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">STATS =</span> <span class="kw">colSums</span>(risk_all), <span class="dt">FUN =</span> <span class="st">&quot;/&quot;</span>)  <span class="co"># normalize each column</span></span>
<span id="cb14-6"><a href="risk-parity-portfolio.html#cb14-6"></a></span>
<span id="cb14-7"><a href="risk-parity-portfolio.html#cb14-7"></a><span class="co"># plot</span></span>
<span id="cb14-8"><a href="risk-parity-portfolio.html#cb14-8"></a><span class="kw">barplot</span>(<span class="kw">t</span>(RRC_all), <span class="dt">col =</span> rainbow8equal[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>],</span>
<span id="cb14-9"><a href="risk-parity-portfolio.html#cb14-9"></a>        <span class="dt">main =</span> <span class="st">&quot;Relative risk contribution&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;stocks&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;risk&quot;</span>, <span class="dt">beside =</span> <span class="ot">TRUE</span>, </span>
<span id="cb14-10"><a href="risk-parity-portfolio.html#cb14-10"></a>        <span class="dt">legend =</span> <span class="kw">colnames</span>(RRC_all))</span></code></pre></div>
<p><img src="portr_files/figure-html/unnamed-chunk-13-2.png" width="80%" style="display: block; margin: auto;" />
We can observe that the solution based on the general solver for the nonconvex formulation is not as perfectly equalized as that from the convex formulation. The reason is that when solving a nonconvex problem one does not have any guarantee of global optimality. In this particular case, we know that perfect risk contribution equalization can actually be achieved (as it is by the solution from the convex formulation) but the nonconvex formulation cannot achieve it.</p>
</div>
<div id="rbp-formulations" class="section level3">
<h3><span class="header-section-number">8.3.6</span> RBP formulations</h3>
<p>This formulation is again based on the double-index summation with budgets:
<span class="math display">\[\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{minimize}} &amp; \sum_{i,j=1}^{N}\left(\frac{w_{i}\left(\boldsymbol{\Sigma}\mathbf{w}\right)_{i}}{b_i} - \frac{w_{j}\left(\boldsymbol{\Sigma}\mathbf{w}\right)_{j}}{b_j}\right)^{2}\\
\textsf{subject to} &amp; \mathbf{1}^T\mathbf{w}=1.
\end{array}\]</span></p>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="alternative-risk-measure.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-a.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["portr.pdf", "portr.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
